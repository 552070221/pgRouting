

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pgRouting Graph Analytics &mdash; pgRouting Manual</title>
    
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0.0 (dd54f87 sew-devel-2_0)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/theme_extras.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="pgRouting Manual" href="../../../index.html" />
    <link rel="up" title="Common Functions" href="index.html" />
    <link rel="next" title="pgRouting Matching" href="pgrouting_matching.html" />
    <link rel="prev" title="pgr_vertexResult[] - Vertex Result set" href="types/vertex_result.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="../../../_static/pgrouting.png" alt="Logo"/><h1 class="heading"><a href="../../../index.html">
          <span>pgRouting Manual</span></a></h1>
        <h2 class="heading"><span>pgRouting Graph Analytics</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="types/vertex_result.html">pgr_vertexResult[] - Vertex Result set</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../doc/index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="pgrouting_matching.html">pgRouting Matching</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="pgrouting-graph-analytics">
<span id="common-analytics"></span><h1>pgRouting Graph Analytics<a class="headerlink" href="#pgrouting-graph-analytics" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Stephen Woodbridge &lt;<a class="reference external" href="mailto:woodbri&#37;&#52;&#48;swoodbridge&#46;com">woodbri<span>&#64;</span>swoodbridge<span>&#46;</span>com</a>&gt;</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">$Date: 2013-03-22 20:14:00 -5000 (Fri, 22 Mar 2013) $</td>
</tr>
<tr class="field-odd field"><th class="field-name">Revision:</th><td class="field-body">$Revision: 0000 $</td>
</tr>
<tr class="field-even field"><th class="field-name">Description:</th><td class="field-body">This is a collection of tools for analyzing graphs. It has been contributed to pgRouting by iMaptools.com.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Copyright:</th><td class="field-body">Stephen Woodbridge. This is released under the MIT-X license.</td>
</tr>
</tbody>
</table>
<p>It is common to find problems with graphs that have not been constructed
fully noded or in graphs with zlevels at intersection that have been
entered incorrectly. An other problem is oneway streets that have been
entered in the wrong direction. We can not detect errors with respect
to &#8220;ground&#8221; truth, but we can look for inconsistencies and some
anomalies in a graph and report them for additional inspections.</p>
<p>We do not current have any visualization tools for these problems, but
I have used mapserver to render the graph and highlight potential
problem areas. Someone familar with graphviz might contribute tools
for generating images with that.</p>
<div class="section" id="analyze-a-graph">
<h2>Analyze a Graph<a class="headerlink" href="#analyze-a-graph" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="pgr_analyzeGraph">
<tt class="descname">pgr_analyzeGraph</tt><big>(</big><em>edge_tab</em>, <em>geom_col</em>, <em>tol</em><big>)</big><a class="headerlink" href="#pgr_analyzeGraph" title="Permalink to this definition">¶</a></dt>
<dd><p>Analyzes the &#8220;edge_tab&#8221; and &#8220;vertices_tmp&#8221; tables and flags if
nodes are deadends, ie vertices_tmp.cnt=1 and identifies nodes
that might be disconnected because of gaps &lt; tol or because of
zlevel errors in the data. For example:</p>
</dd></dl>

<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="n">pgr_analyzeGraph</span><span class="p">(</span><span class="s1">&#39;mytab&#39;</span><span class="p">,</span> <span class="s1">&#39;the_geom&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">000002</span><span class="p">);</span>
</pre></div>
</div>
<p>After the analyzing the graph, deadends are indentified by <em>cnt=1</em>
in the &#8220;vertices_tmp&#8221; table and potential problems are identified
with <em>chk=1</em>.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">vertices_tmp</span> <span class="k">where</span> <span class="n">chk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="analyze-one-way-streets">
<h2>Analyze One Way Streets<a class="headerlink" href="#analyze-one-way-streets" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="pgr_analyzeOneway">
<tt class="descname">pgr_analyzeOneway</tt><big>(</big><em>tab</em>, <em>col</em>, <em>s_in_rules</em>, <em>s_out_rules</em>, <em>t_in_rules</em>, <em>t_out_rules</em><big>)</big><a class="headerlink" href="#pgr_analyzeOneway" title="Permalink to this definition">¶</a></dt>
<dd><p>This function analyzes oneway streets in a graph and identifies any
flipped segments. Basically if you count the edges coming into a node
and the edges exiting a node the number has to be greater than one.</p>
<ul class="simple">
<li>tab              - edge table name (TEXT)</li>
<li>col              - oneway column name (TEXT)</li>
<li>s_in_rules       - source node in rules</li>
<li>s_out_rules      - source node out rules</li>
<li>t_in_tules       - target node in rules</li>
<li>t_out_rules      - target node out rules</li>
<li>two_way_if_null  - flag to treat oneway nNULL values as by directional</li>
</ul>
<p>After running this on a graph you can identify nodes with potential
problems with the following query.</p>
</dd></dl>

<div class="highlight-sql"><div class="highlight"><pre>    <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">vertices_tmp</span> <span class="k">where</span> <span class="k">in</span><span class="o">=</span><span class="mi">0</span> <span class="k">or</span> <span class="k">out</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="n">The</span> <span class="n">rules</span> <span class="k">are</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">an</span> <span class="nb">array</span> <span class="k">of</span> <span class="nb">text</span> <span class="n">strings</span> <span class="n">that</span> <span class="n">if</span> <span class="k">match</span> <span class="n">the</span> <span class="ss">&quot;col&quot;</span>
<span class="n">value</span> <span class="n">would</span> <span class="n">be</span> <span class="n">counted</span> <span class="k">as</span> <span class="k">true</span> <span class="k">for</span> <span class="n">the</span> <span class="k">source</span> <span class="k">or</span> <span class="n">target</span> <span class="k">in</span> <span class="k">or</span> <span class="k">out</span> <span class="n">condition</span><span class="p">.</span>

<span class="n">Example</span>
<span class="o">=======</span>

<span class="n">Lets</span> <span class="n">assume</span> <span class="n">we</span> <span class="n">have</span> <span class="n">a</span> <span class="k">table</span> <span class="ss">&quot;st&quot;</span> <span class="k">of</span> <span class="n">edges</span> <span class="k">and</span> <span class="n">a</span> <span class="k">column</span> <span class="ss">&quot;one_way&quot;</span> <span class="n">that</span>
<span class="n">might</span> <span class="n">have</span> <span class="k">values</span> <span class="k">like</span><span class="p">:</span>

<span class="o">*</span> <span class="s1">&#39;FT&#39;</span>    <span class="o">-</span> <span class="n">oneway</span> <span class="k">from</span> <span class="n">the</span> <span class="k">source</span> <span class="k">to</span> <span class="n">the</span> <span class="n">target</span> <span class="n">node</span><span class="p">.</span>
<span class="o">*</span> <span class="s1">&#39;TF&#39;</span>    <span class="o">-</span> <span class="n">oneway</span> <span class="k">from</span> <span class="n">the</span> <span class="n">target</span> <span class="k">to</span> <span class="n">the</span> <span class="k">source</span> <span class="n">node</span><span class="p">.</span>
<span class="o">*</span> <span class="s1">&#39;B&#39;</span>     <span class="o">-</span> <span class="n">two</span> <span class="n">way</span> <span class="n">street</span><span class="p">.</span>
<span class="o">*</span> <span class="s1">&#39;&#39;</span>      <span class="o">-</span> <span class="n">empty</span> <span class="n">field</span><span class="p">,</span> <span class="n">assume</span> <span class="n">twoway</span><span class="p">.</span>
<span class="o">*</span> <span class="o">&lt;</span><span class="k">NULL</span><span class="o">&gt;</span>  <span class="o">-</span> <span class="k">NULL</span> <span class="n">field</span><span class="p">,</span> <span class="n">use</span> <span class="n">two_way_if_null</span> <span class="n">flag</span><span class="p">.</span>

<span class="k">Then</span> <span class="n">we</span> <span class="n">could</span> <span class="n">form</span> <span class="n">the</span> <span class="n">following</span> <span class="n">query</span> <span class="k">to</span> <span class="k">analyze</span> <span class="n">the</span> <span class="n">oneway</span> <span class="n">streets</span> <span class="k">for</span>
<span class="n">errors</span><span class="p">.</span>
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="n">pgr_analyzeOneway</span><span class="p">(</span><span class="s1">&#39;st&#39;</span><span class="p">,</span> <span class="s1">&#39;one_way&#39;</span><span class="p">,</span>
     <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;TF&#39;</span><span class="p">],</span>
     <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;FT&#39;</span><span class="p">],</span>
     <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;FT&#39;</span><span class="p">],</span>
     <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;TF&#39;</span><span class="p">],</span>
     <span class="k">true</span><span class="p">);</span>

<span class="c1">-- now we can see the problem nodes</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">vertices_tmp</span> <span class="k">where</span> <span class="n">ein</span><span class="o">=</span><span class="mi">0</span> <span class="k">or</span> <span class="n">eout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">-- and the problem edges connected to those nodes</span>
<span class="k">select</span> <span class="n">gid</span>
  <span class="k">from</span> <span class="n">st</span> <span class="n">a</span><span class="p">,</span> <span class="n">vertices_tmp</span> <span class="n">b</span>
 <span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="k">source</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">id</span> <span class="k">and</span> <span class="n">ein</span><span class="o">=</span><span class="mi">0</span> <span class="k">or</span> <span class="n">eout</span><span class="o">=</span><span class="mi">0</span>
<span class="k">union</span>
<span class="k">select</span> <span class="n">gid</span>
  <span class="k">from</span> <span class="n">st</span> <span class="n">a</span><span class="p">,</span> <span class="n">vertices_tmp</span> <span class="n">b</span>
 <span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="n">target</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">id</span> <span class="k">and</span> <span class="n">ein</span><span class="o">=</span><span class="mi">0</span> <span class="k">or</span> <span class="n">eout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Typically these problems are generated by a break in the network, the
oneway direction set wrong, maybe an error releted to zlevels or
a network that is not properly noded.</p>
</div>
<div class="section" id="utility-functions">
<h2>Utility functions<a class="headerlink" href="#utility-functions" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><dl class="function">
<dt id="pgr_isColumnInTable">
<tt class="descname">pgr_isColumnInTable</tt><big>(</big><em>tab</em>, <em>col</em><big>)</big><a class="headerlink" href="#pgr_isColumnInTable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true or false if column &#8220;col&#8221; exists in table &#8220;tab&#8221;</p>
</dd></dl>

<dl class="function">
<dt id="pgr_isColumnIndexed">
<tt class="descname">pgr_isColumnIndexed</tt><big>(</big><em>tab</em>, <em>col</em><big>)</big><a class="headerlink" href="#pgr_isColumnIndexed" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true or false if column &#8220;col&#8221; in table &#8220;tab&#8221; is indexed.</p>
</dd></dl>

</div></blockquote>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="types/vertex_result.html">pgr_vertexResult[] - Vertex Result set</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../doc/index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="pgrouting_matching.html">pgRouting Matching</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright pgRouting Contributors.
      Last updated on May 14, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>