<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pgRouting Concepts &mdash; pgRouting Manual (2.4-dev)</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="pgRouting Manual (2.4-dev)" href="index.html" />
    <link rel="next" title="Sample Data" href="sampledata.html" />
    <link rel="prev" title="Support" href="support.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/pgrouting.png"></span>
          pgRouting</a>
        <span class="navbar-text navbar-version pull-left"><b>v2.4.0-dev</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">pgRouting Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="#queries-results">Queries &amp; Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="#advanced-topics">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="#performance-tips">Performance Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="#user-s-recipes-list">User&#8217;s Recipes List</a></li>
<li class="toctree-l1"><a class="reference internal" href="#how-to-contribute">How to contribute.</a></li>
<li class="toctree-l1"><a class="reference internal" href="#developer-s-guide">Developer&#8217;s Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sampledata.html">Sample Data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pgr_version.html">pgr_version</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="types_index.html">pgRouting Data Types</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Topology Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="routingFunctions.html">Routing Functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="proposedNext.html">Stable proposed Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="proposed.html">Experimental and Proposed functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-4-0-release-notes">pgRouting 2.4.0 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-3-2-release-notes">pgRouting 2.3.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-3-1-release-notes">pgRouting 2.3.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-3-0-release-notes">pgRouting 2.3.0 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-2-4-release-notes">pgRouting 2.2.4 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-2-3-release-notes">pgRouting 2.2.3 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-2-2-release-notes">pgRouting 2.2.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-2-1-release-notes">pgRouting 2.2.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-2-0-release-notes">pgRouting 2.2.0 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-1-0-release-notes">pgRouting 2.1.0 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-0-1-release-notes">pgRouting 2.0.1 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-2-0-0-release-notes">pgRouting 2.0.0 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html#pgrouting-1-x-release-notes">pgRouting 1.x Release Notes</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">pgRouting Concepts</a><ul>
<li><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li><a class="reference internal" href="#create-a-routing-database">Create a routing Database</a></li>
<li><a class="reference internal" href="#load-data">Load Data</a></li>
<li><a class="reference internal" href="#build-a-routing-topology">Build a Routing Topology</a></li>
<li><a class="reference internal" href="#check-the-routing-topology">Check the Routing Topology</a></li>
<li><a class="reference internal" href="#compute-a-path">Compute a Path</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#queries-results">Queries &amp; Results</a><ul>
<li><a class="reference internal" href="#inner-queries">Inner Queries</a><ul>
<li><a class="reference internal" href="#description-of-the-edges-sql-query-for-dijkstra-like-functions">Description of the edges_sql query for dijkstra like functions</a></li>
<li><a class="reference internal" href="#description-of-the-edges-sql-query-id-is-not-necessary">Description of the edges_sql query (id is not necessary)</a></li>
<li><a class="reference internal" href="#description-of-the-edges-sql-query-for-astar-like-functions">Description of the edges_sql query for astar like functions</a></li>
<li><a class="reference internal" href="#description-of-the-edges-sql-query-for-max-flow-like-functions">Description of the edges_sql query for Max-flow like functions</a></li>
<li><a class="reference internal" href="#description-of-the-points-sql-query">Description of the Points SQL query</a></li>
</ul>
</li>
<li><a class="reference internal" href="#return-columns-values">Return columns &amp; values</a><ul>
<li><a class="reference internal" href="#description-of-the-return-values-for-a-path">Description of the return values for a path</a></li>
<li><a class="reference internal" href="#description-of-the-return-values-for-a-cost-function">Description of the return values for a Cost function</a></li>
<li><a class="reference internal" href="#description-of-the-return-values">Description of the Return Values</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-topics">Advanced Topics</a><ul>
<li><a class="reference internal" href="#routing-topology">Routing Topology</a></li>
<li><a class="reference internal" href="#see-also">See Also</a><ul>
<li><a class="reference internal" href="#graph-analytics">Graph Analytics</a></li>
<li><a class="reference internal" href="#analyze-a-graph">Analyze a Graph</a></li>
<li><a class="reference internal" href="#analyze-one-way-streets">Analyze One Way Streets</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-tips">Performance Tips</a></li>
<li><a class="reference internal" href="#user-s-recipes-list">User&#8217;s Recipes List</a></li>
<li><a class="reference internal" href="#how-to-contribute">How to contribute.</a><ul>
<li><a class="reference internal" href="#comparing-topology-of-a-unnoded-network-with-a-noded-network">Comparing topology of a unnoded network with a noded network</a></li>
<li><a class="reference internal" href="#handling-parallels-after-getting-a-path-pgr-ksp-focus">Handling parallels after getting a path (pgr_ksp focus)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#developer-s-guide">Developer&#8217;s Guide</a><ul>
<li><a class="reference internal" href="#source-tree-layout">Source Tree Layout</a></li>
<li><a class="reference internal" href="#tools">Tools</a></li>
<li><a class="reference internal" href="#documentation-layout">Documentation Layout</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="support.html" title="Previous Chapter: Support"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Support</span>
    </a>
  </li>
  <li>
    <a href="sampledata.html" title="Next Chapter: Sample Data"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Sample Data &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/pgRouting-concepts.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="pgrouting-concepts">
<span id="id1"></span><h1>pgRouting Concepts<a class="headerlink" href="#pgrouting-concepts" title="Permalink to this headline">¶</a></h1>
<p class="rubric">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#getting-started"><em>Getting Started</em></a><ul>
<li><a class="reference internal" href="#create-database"><em>Create a routing Database</em></a></li>
<li><a class="reference internal" href="#load-data"><em>Load Data</em></a></li>
<li><a class="reference internal" href="#build-topology"><em>Build a Routing Topology</em></a></li>
<li><a class="reference internal" href="#check-graph"><em>Check the Routing Topology</em></a></li>
<li><a class="reference internal" href="#compute-path"><em>Compute a Path</em></a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-query"><em>Queries &amp; Results</em></a><ul>
<li><a class="reference internal" href="#inner-queries"><em>Inner Queries</em></a></li>
<li><a class="reference internal" href="#return-values"><em>Return columns &amp; values</em></a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-topics"><em>Advanced Topics</em></a><ul>
<li><a class="reference internal" href="#topology"><em>Routing Topology</em></a> for an overview of a topology for routing algorithms.</li>
<li><a class="reference internal" href="#analytics"><em>Graph Analytics</em></a> for an overview of the analysis of a graph.</li>
<li><a class="reference internal" href="#performance"><em>Performance Tips</em></a> to improve your performance.</li>
</ul>
</li>
<li>Contributing<ul>
<li><a class="reference internal" href="#recipes"><em>User&#8217;s Recipes List</em></a></li>
<li><a class="reference internal" href="#developer"><em>Developer&#8217;s Guide</em></a></li>
</ul>
</li>
<li><a class="reference external" href="http://workshop.pgrouting.org">pgRouting Workshop</a></li>
</ul>
<div class="section" id="getting-started">
<span id="id2"></span><h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>This is a simple guide to walk you through the steps of getting started
with pgRouting. In this guide we will cover:</p>
<ul class="simple">
<li><a class="reference internal" href="#create-database"><em>Create a routing Database</em></a></li>
<li><a class="reference internal" href="#load-data"><em>Load Data</em></a></li>
<li><a class="reference internal" href="#build-topology"><em>Build a Routing Topology</em></a></li>
<li><a class="reference internal" href="#check-graph"><em>Check the Routing Topology</em></a></li>
</ul>
<div class="section" id="create-a-routing-database">
<span id="create-database"></span><h3>Create a routing Database<a class="headerlink" href="#create-a-routing-database" title="Permalink to this headline">¶</a></h3>
<p>The first thing we need to do is create a database and load pgrouting in
the database. Typically you will create a database for each project. Once
you have a database to work in, your can load your data and build your
application in that database. This makes it easy to move your project
later if you want to to say a production server.</p>
<p>For Postgresql 9.2 and later versions</p>
<div class="highlight-bash"><div class="highlight"><pre>createdb mydatabase
psql mydatabase -c <span class="s2">&quot;create extension postgis&quot;</span>
psql mydatabase -c <span class="s2">&quot;create extension pgrouting&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="load-data">
<span id="id3"></span><h3>Load Data<a class="headerlink" href="#load-data" title="Permalink to this headline">¶</a></h3>
<p>How you load your data will depend in what form it comes it. There are
various OpenSource tools that can help you, like:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">osm2pgrouting:</th><td class="field-body"><ul class="first simple">
<li>this is a tool for loading OSM data into postgresql with pgRouting requirements</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">shp2pgsql:</th><td class="field-body"><ul class="first simple">
<li>this is the postgresql shapefile loader</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">ogr2ogr:</th><td class="field-body"><ul class="first simple">
<li>this is a vector data conversion utility</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">osm2pgsql:</th><td class="field-body"><ul class="first last simple">
<li>this is a tool for loading OSM data into postgresql</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>So these tools and probably others will allow you to read vector data so that
you may then load that data into your database as a table of some kind. At this
point you need to know a little about your data structure and content. One easy
way to browse your new data table is with pgAdmin3 or phpPgAdmin.</p>
</div>
<div class="section" id="build-a-routing-topology">
<span id="build-topology"></span><h3>Build a Routing Topology<a class="headerlink" href="#build-a-routing-topology" title="Permalink to this headline">¶</a></h3>
<p>Next we need to build a topology for our street data. What this means is that
for any given edge in your street data the ends of that edge will be connected
to a unique node and to other edges that are also connected to that same unique
node. Once all the edges are connected to nodes we have a graph that can be
used for routing with pgrouting. We provide a tool that will help with this:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this step is not needed if data is loaded with <cite>osm2pgrouting</cite></p>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="n">pgr_createTopology</span><span class="p">(</span><span class="s1">&#39;myroads&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">000001</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><a class="reference internal" href="pgr_createTopology.html#pgr-create-topology"><em>pgr_createTopology</em></a></li>
</ul>
</div>
<div class="section" id="check-the-routing-topology">
<span id="check-graph"></span><h3>Check the Routing Topology<a class="headerlink" href="#check-the-routing-topology" title="Permalink to this headline">¶</a></h3>
<p>There are lots of possible sources for errors in a graph. The data that you
started with may not have been designed with routing in mind. A graph has some
very specific requirements. One is that it is <em>NODED</em>, this means that except
for some very specific use cases, each road segment starts and ends at a node
and that in general is does not cross another road segment that it should be
connected to.</p>
<p>There can be other errors like the direction of a one-way street being entered
in the wrong direction. We do not have tools to search for all possible errors
but we have some basic tools that might help.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="n">pgr_analyzegraph</span><span class="p">(</span><span class="s1">&#39;myroads&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">000001</span><span class="p">);</span>
<span class="k">select</span> <span class="n">pgr_analyzeoneway</span><span class="p">(</span><span class="s1">&#39;myroads&#39;</span><span class="p">,</span>  <span class="n">s_in_rules</span><span class="p">,</span> <span class="n">s_out_rules</span><span class="p">,</span>
                                     <span class="n">t_in_rules</span><span class="p">,</span> <span class="n">t_out_rules</span>
                                     <span class="n">direction</span><span class="p">)</span>
<span class="k">select</span> <span class="n">pgr_nodeNetwork</span><span class="p">(</span><span class="s1">&#39;myroads&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><a class="reference internal" href="pgr_analyzeGraph.html#pgr-analyze-graph"><em>pgr_analyzeGraph</em></a></li>
<li><a class="reference internal" href="pgr_analyzeOneWay.html#pgr-analyze-oneway"><em>pgr_analyzeOneway</em></a></li>
<li><a class="reference internal" href="pgr_nodeNetwork.html#pgr-node-network"><em>pgr_nodeNetwork</em></a></li>
</ul>
</div>
<div class="section" id="compute-a-path">
<span id="compute-path"></span><h3>Compute a Path<a class="headerlink" href="#compute-a-path" title="Permalink to this headline">¶</a></h3>
<p>Once you have all the preparation work done above, computing a route is fairly easy.
We have a lot of different algorithms that can work with your prepared road
network. The general form of a route query is:</p>
<div class="highlight-sql"><div class="highlight"><pre>select pgr_dijkstra(`SELECT * FROM myroads&#39;, 1, 2)
</pre></div>
</div>
<p>As you can see this is fairly straight forward and you can look and the
specific algorithms for the details of the signatures and how to use them.
These results have information like edge id and/or the
node id along with the cost or geometry for the step in the path from <em>start</em>
to <em>end</em>. Using the ids you can join these result back to your edge table
to get more information about each step in the path.</p>
<ul class="simple">
<li><a class="reference internal" href="pgr_dijkstra.html#pgr-dijkstra"><em>pgr_dijkstra</em></a></li>
</ul>
<p class="rubric">Indices and tables</p>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>
</div>
<div class="section" id="queries-results">
<span id="custom-query"></span><h1>Queries &amp; Results<a class="headerlink" href="#queries-results" title="Permalink to this headline">¶</a></h1>
<p>There are several kinds of valid inner queries and also the columns returned are debending of the function..
Which kind of <strong>edges_sql</strong> will depend on the function(s) requirements.</p>
<div class="section" id="inner-queries">
<span id="id4"></span><h2>Inner Queries<a class="headerlink" href="#inner-queries" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description-of-the-edges-sql-query-for-dijkstra-like-functions">
<h3>Description of the edges_sql query for dijkstra like functions<a class="headerlink" href="#description-of-the-edges-sql-query-for-dijkstra-like-functions" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">edges_sql:</th><td class="field-body">an SQL query, which should return a set of rows with the following columns:</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="6%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>id</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>source</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the first end point vertex of the edge.</td>
</tr>
<tr class="row-even"><td><strong>target</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the second end point vertex of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>cost</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>&nbsp;</td>
<td><dl class="first last docutils">
<dt>Weight of the edge  <cite>(source, target)</cite></dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(source, target)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><strong>reverse_cost</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>-1</td>
<td><dl class="first last docutils">
<dt>Weight of the edge <cite>(target, source)</cite>,</dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(target, source)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>Where:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ANY-INTEGER:</th><td class="field-body">SMALLINT, INTEGER, BIGINT</td>
</tr>
<tr class="field-even field"><th class="field-name">ANY-NUMERICAL:</th><td class="field-body">SMALLINT, INTEGER, BIGINT, REAL, FLOAT</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description-of-the-edges-sql-query-id-is-not-necessary">
<h3>Description of the edges_sql query (id is not necessary)<a class="headerlink" href="#description-of-the-edges-sql-query-id-is-not-necessary" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">edges_sql:</th><td class="field-body">an SQL query, which should return a set of rows with the following columns:</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="6%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>source</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the first end point vertex of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>target</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the second end point vertex of the edge.</td>
</tr>
<tr class="row-even"><td><strong>cost</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>&nbsp;</td>
<td><dl class="first last docutils">
<dt>Weight of the edge  <cite>(source, target)</cite></dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(source, target)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><strong>reverse_cost</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>-1</td>
<td><dl class="first last docutils">
<dt>Weight of the edge <cite>(target, source)</cite>,</dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(target, source)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>Where:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ANY-INTEGER:</th><td class="field-body">SMALLINT, INTEGER, BIGINT</td>
</tr>
<tr class="field-even field"><th class="field-name">ANY-NUMERICAL:</th><td class="field-body">SMALLINT, INTEGER, BIGINT, REAL, FLOAT</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description-of-the-edges-sql-query-for-astar-like-functions">
<h3>Description of the edges_sql query for astar like functions<a class="headerlink" href="#description-of-the-edges-sql-query-for-astar-like-functions" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">edges_sql:</th><td class="field-body">an SQL query, which should return a set of rows with the following columns:</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="6%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>id</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>source</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the first end point vertex of the edge.</td>
</tr>
<tr class="row-even"><td><strong>target</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the second end point vertex of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>cost</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>&nbsp;</td>
<td><dl class="first last docutils">
<dt>Weight of the edge  <cite>(source, target)</cite></dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(source, target)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><strong>reverse_cost</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>-1</td>
<td><dl class="first last docutils">
<dt>Weight of the edge <cite>(target, source)</cite>,</dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(target, source)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><strong>x1</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>&nbsp;</td>
<td>X coordinate of <cite>source</cite> vertex.</td>
</tr>
<tr class="row-even"><td><strong>y1</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>&nbsp;</td>
<td>Y coordinate of <cite>source</cite> vertex.</td>
</tr>
<tr class="row-odd"><td><strong>x2</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>&nbsp;</td>
<td>X coordinate of <cite>target</cite> vertex.</td>
</tr>
<tr class="row-even"><td><strong>y2</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>&nbsp;</td>
<td>Y coordinate of <cite>target</cite> vertex.</td>
</tr>
</tbody>
</table>
<p>Where:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ANY-INTEGER:</th><td class="field-body">SMALLINT, INTEGER, BIGINT</td>
</tr>
<tr class="field-even field"><th class="field-name">ANY-NUMERICAL:</th><td class="field-body">SMALLINT, INTEGER, BIGINT, REAL, FLOAT</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description-of-the-edges-sql-query-for-max-flow-like-functions">
<h3>Description of the edges_sql query for Max-flow like functions<a class="headerlink" href="#description-of-the-edges-sql-query-for-max-flow-like-functions" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">edges_sql:</th><td class="field-body">an SQL query, which should return a set of rows with the following columns:</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="13%" />
<col width="6%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>id</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>source</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the first end point vertex of the edge.</td>
</tr>
<tr class="row-even"><td><strong>target</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td>Identifier of the second end point vertex of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>capacity</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>&nbsp;</td>
<td><dl class="first last docutils">
<dt>Weight of the edge  <cite>(source, target)</cite></dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(source, target)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><strong>reverse_capacity</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>-1</td>
<td><dl class="first last docutils">
<dt>Weight of the edge <cite>(target, source)</cite>,</dt>
<dd><ul class="first last simple">
<li>When negative: edge <cite>(target, source)</cite> does not exist, therefore it&#8217;s not part of the graph.</li>
</ul>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>Where:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ANY-INTEGER:</th><td class="field-body">SMALLINT, INTEGER, BIGINT</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description-of-the-points-sql-query">
<h3>Description of the Points SQL query<a class="headerlink" href="#description-of-the-points-sql-query" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">points_sql:</th><td class="field-body">an SQL query, which should return a set of rows with the following columns:</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="14%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>pid</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td><dl class="first last docutils">
<dt>(optional) Identifier of the point.</dt>
<dd><ul class="first last simple">
<li>If column present, it can not be NULL.</li>
<li>If column not present, a sequential identifier will be given automatically.</li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><strong>edge_id</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-INTEGER</span></tt></td>
<td>Identifier of the &#8220;closest&#8221; edge to the point.</td>
</tr>
<tr class="row-even"><td><strong>fraction</strong></td>
<td><tt class="docutils literal"><span class="pre">ANY-NUMERICAL</span></tt></td>
<td>Value in &lt;0,1&gt; that indicates the relative postition from the first end point of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>side</strong></td>
<td><tt class="docutils literal"><span class="pre">CHAR</span></tt></td>
<td><dl class="first last docutils">
<dt>(optional) Value in [&#8216;b&#8217;, &#8216;r&#8217;, &#8216;l&#8217;, NULL] indicating if the point is:</dt>
<dd><ul class="first last simple">
<li>In the right, left of the edge or</li>
<li>If it doesn&#8217;t matter with &#8216;b&#8217; or NULL.</li>
<li>If column not present &#8216;b&#8217; is considered.</li>
</ul>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>Where:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">ANY-INTEGER:</th><td class="field-body">smallint, int, bigint</td>
</tr>
<tr class="field-even field"><th class="field-name">ANY-NUMERICAL:</th><td class="field-body">smallint, int, bigint, real, float</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="return-columns-values">
<span id="return-values"></span><h2>Return columns &amp; values<a class="headerlink" href="#return-columns-values" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description-of-the-return-values-for-a-path">
<h3>Description of the return values for a path<a class="headerlink" href="#description-of-the-return-values-for-a-path" title="Permalink to this headline">¶</a></h3>
<p>Returns set of <tt class="docutils literal"><span class="pre">(seq,</span> <span class="pre">path_seq</span> <span class="pre">[,</span> <span class="pre">start_vid]</span> <span class="pre">[,</span> <span class="pre">end_vid],</span> <span class="pre">node,</span> <span class="pre">edge,</span> <span class="pre">cost,</span> <span class="pre">agg_cost)</span></tt></p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="6%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>seq</strong></td>
<td><tt class="docutils literal"><span class="pre">INT</span></tt></td>
<td>Sequential value starting from <strong>1</strong>.</td>
</tr>
<tr class="row-odd"><td><strong>path_id</strong></td>
<td><tt class="docutils literal"><span class="pre">INT</span></tt></td>
<td>Path identifier. Has value <strong>1</strong> for the first of a path. Used when there are multiple paths for the same <tt class="docutils literal"><span class="pre">start_vid</span></tt> to <tt class="docutils literal"><span class="pre">end_vid</span></tt> combination.</td>
</tr>
<tr class="row-even"><td><strong>path_seq</strong></td>
<td><tt class="docutils literal"><span class="pre">INT</span></tt></td>
<td>Relative position in the path. Has value <strong>1</strong> for the beginning of a path.</td>
</tr>
<tr class="row-odd"><td><strong>start_vid</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the starting vertex. Used when multiple starting vetrices are in the query.</td>
</tr>
<tr class="row-even"><td><strong>end_vid</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the ending vertex. Used when multiple ending vertices are in the query.</td>
</tr>
<tr class="row-odd"><td><strong>node</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the node in the path from <tt class="docutils literal"><span class="pre">start_vid</span></tt> to <tt class="docutils literal"><span class="pre">end_vid</span></tt>.</td>
</tr>
<tr class="row-even"><td><strong>edge</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the edge used to go from <tt class="docutils literal"><span class="pre">node</span></tt> to the next node in the path sequence. <tt class="docutils literal"><span class="pre">-1</span></tt> for the last node of the path.</td>
</tr>
<tr class="row-odd"><td><strong>cost</strong></td>
<td><tt class="docutils literal"><span class="pre">FLOAT</span></tt></td>
<td>Cost to traverse from <tt class="docutils literal"><span class="pre">node</span></tt> using <tt class="docutils literal"><span class="pre">edge</span></tt> to the next node in the path sequence.</td>
</tr>
<tr class="row-even"><td><strong>agg_cost</strong></td>
<td><tt class="docutils literal"><span class="pre">FLOAT</span></tt></td>
<td>Aggregate cost from <tt class="docutils literal"><span class="pre">start_v</span></tt> to <tt class="docutils literal"><span class="pre">node</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description-of-the-return-values-for-a-cost-function">
<h3>Description of the return values for a Cost function<a class="headerlink" href="#description-of-the-return-values-for-a-cost-function" title="Permalink to this headline">¶</a></h3>
<p>Returns set of <tt class="docutils literal"><span class="pre">(start_vid,</span> <span class="pre">end_vid,</span> <span class="pre">agg_cost)</span></tt></p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="9%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>start_vid</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the starting vertex. Used when multiple starting vetrices are in the query.</td>
</tr>
<tr class="row-odd"><td><strong>end_vid</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the ending vertex. Used when multiple ending vertices are in the query.</td>
</tr>
<tr class="row-even"><td><strong>agg_cost</strong></td>
<td><tt class="docutils literal"><span class="pre">FLOAT</span></tt></td>
<td>Aggregate cost from <tt class="docutils literal"><span class="pre">start_vid</span></tt> to <tt class="docutils literal"><span class="pre">end_vid</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description-of-the-return-values">
<h3>Description of the Return Values<a class="headerlink" href="#description-of-the-return-values" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="19%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>seq</strong></td>
<td><tt class="docutils literal"><span class="pre">INT</span></tt></td>
<td>Sequential value starting from <strong>1</strong>.</td>
</tr>
<tr class="row-odd"><td><strong>edge_id</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the edge in the original query(edges_sql).</td>
</tr>
<tr class="row-even"><td><strong>source</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the first end point vertex of the edge.</td>
</tr>
<tr class="row-odd"><td><strong>target</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Identifier of the second end point vertex of the edge.</td>
</tr>
<tr class="row-even"><td><strong>flow</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Flow through the edge in the direction (source, target).</td>
</tr>
<tr class="row-odd"><td><strong>residual_capacity</strong></td>
<td><tt class="docutils literal"><span class="pre">BIGINT</span></tt></td>
<td>Residual capacity of the edge in the direction (source, target).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="advanced-topics">
<span id="id5"></span><h1>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="routing-topology">
<span id="topology"></span><h2>Routing Topology<a class="headerlink" href="#routing-topology" title="Permalink to this headline">¶</a></h2>
<p class="rubric">Overview</p>
<p>Typically when GIS files are loaded into the data database for use with pgRouting they do not have topology information associated with them. To create a useful topology the data needs to be &#8220;noded&#8221;. This means that where two or more roads form an intersection there it needs to be a node at the intersection and all the road segments need to be broken at the intersection, assuming that you can navigate from any of these segments to any other segment via that intersection.</p>
<p>You can use the <a class="reference internal" href="#analytics"><em>graph analysis functions</em></a> to help you see where you might have topology problems in your data. If you need to node your data, we also have a function <a class="reference internal" href="pgr_nodeNetwork.html#pgr-node-network"><em>pgr_nodeNetwork()</em></a> that might work for you. This function splits ALL crossing segments and nodes them. There are some cases where this might NOT be the right thing to do.</p>
<p>For example, when you have an overpass and underpass intersection, you do not want these noded, but pgr_nodeNetwork does not know that is the case and will node them which is not good because then the router will be able to turn off the overpass onto the underpass like it was a flat 2D intersection. To deal with this problem some data sets use z-levels at these types of intersections and other data might not node these intersection which would be ok.</p>
<p>For those cases where topology needs to be added the following functions may be useful. One way to prep the data for pgRouting is to add the following columns to your table and then populate them as appropriate. This example makes a lot of assumption like that you original data tables already has certain columns in it like <tt class="docutils literal"><span class="pre">one_way</span></tt>, <tt class="docutils literal"><span class="pre">fcc</span></tt>, and possibly others and that they contain specific data values. This is only to give you an idea of what you can do with your data.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">edge_table</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">source</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">target</span> <span class="nb">integer</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">cost_len</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">cost_time</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">rcost_len</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">rcost_time</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">x1</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">y1</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">x2</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">y2</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">to_cost</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">rule</span> <span class="nb">text</span><span class="p">,</span>
    <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">isolated</span> <span class="nb">integer</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">pgr_createTopology</span><span class="p">(</span><span class="s1">&#39;edge_table&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">000001</span><span class="p">,</span> <span class="s1">&#39;the_geom&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The function <a class="reference internal" href="pgr_createTopology.html#pgr-create-topology"><em>pgr_createTopology()</em></a> will create the <tt class="docutils literal"><span class="pre">vertices_tmp</span></tt> table and populate the <tt class="docutils literal"><span class="pre">source</span></tt> and <tt class="docutils literal"><span class="pre">target</span></tt> columns. The following example populated the remaining columns. In this example, the <tt class="docutils literal"><span class="pre">fcc</span></tt> column contains feature class code and the <tt class="docutils literal"><span class="pre">CASE</span></tt> statements converts it to an average speed.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">edge_table</span> <span class="k">SET</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">st_x</span><span class="p">(</span><span class="n">st_startpoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)),</span>
                      <span class="n">y1</span> <span class="o">=</span> <span class="n">st_y</span><span class="p">(</span><span class="n">st_startpoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)),</span>
                      <span class="n">x2</span> <span class="o">=</span> <span class="n">st_x</span><span class="p">(</span><span class="n">st_endpoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)),</span>
                      <span class="n">y2</span> <span class="o">=</span> <span class="n">st_y</span><span class="p">(</span><span class="n">st_endpoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)),</span>
  <span class="n">cost_len</span>  <span class="o">=</span> <span class="n">st_length_spheroid</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span> <span class="s1">&#39;SPHEROID[&quot;WGS84&quot;,6378137,298.25728]&#39;</span><span class="p">),</span>
  <span class="n">rcost_len</span> <span class="o">=</span> <span class="n">st_length_spheroid</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span> <span class="s1">&#39;SPHEROID[&quot;WGS84&quot;,6378137,298.25728]&#39;</span><span class="p">),</span>
  <span class="n">len_km</span> <span class="o">=</span> <span class="n">st_length_spheroid</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span> <span class="s1">&#39;SPHEROID[&quot;WGS84&quot;,6378137,298.25728]&#39;</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span>
  <span class="n">len_miles</span> <span class="o">=</span> <span class="n">st_length_spheroid</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span> <span class="s1">&#39;SPHEROID[&quot;WGS84&quot;,6378137,298.25728]&#39;</span><span class="p">)</span>
              <span class="o">/</span> <span class="mi">1000</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">6213712</span><span class="p">,</span>
  <span class="n">speed_mph</span> <span class="o">=</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A10&#39;</span> <span class="k">THEN</span> <span class="mi">65</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A15&#39;</span> <span class="k">THEN</span> <span class="mi">65</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A20&#39;</span> <span class="k">THEN</span> <span class="mi">55</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A25&#39;</span> <span class="k">THEN</span> <span class="mi">55</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A30&#39;</span> <span class="k">THEN</span> <span class="mi">45</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A35&#39;</span> <span class="k">THEN</span> <span class="mi">45</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A40&#39;</span> <span class="k">THEN</span> <span class="mi">35</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A45&#39;</span> <span class="k">THEN</span> <span class="mi">35</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A50&#39;</span> <span class="k">THEN</span> <span class="mi">25</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A60&#39;</span> <span class="k">THEN</span> <span class="mi">25</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A61&#39;</span> <span class="k">THEN</span> <span class="mi">25</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A62&#39;</span> <span class="k">THEN</span> <span class="mi">25</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A64&#39;</span> <span class="k">THEN</span> <span class="mi">25</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A70&#39;</span> <span class="k">THEN</span> <span class="mi">15</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A69&#39;</span> <span class="k">THEN</span> <span class="mi">10</span>
                   <span class="k">ELSE</span> <span class="k">null</span> <span class="k">END</span><span class="p">,</span>
  <span class="n">speed_kmh</span> <span class="o">=</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A10&#39;</span> <span class="k">THEN</span> <span class="mi">104</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A15&#39;</span> <span class="k">THEN</span> <span class="mi">104</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A20&#39;</span> <span class="k">THEN</span> <span class="mi">88</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A25&#39;</span> <span class="k">THEN</span> <span class="mi">88</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A30&#39;</span> <span class="k">THEN</span> <span class="mi">72</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A35&#39;</span> <span class="k">THEN</span> <span class="mi">72</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A40&#39;</span> <span class="k">THEN</span> <span class="mi">56</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A45&#39;</span> <span class="k">THEN</span> <span class="mi">56</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A50&#39;</span> <span class="k">THEN</span> <span class="mi">40</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A60&#39;</span> <span class="k">THEN</span> <span class="mi">50</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A61&#39;</span> <span class="k">THEN</span> <span class="mi">40</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A62&#39;</span> <span class="k">THEN</span> <span class="mi">40</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A64&#39;</span> <span class="k">THEN</span> <span class="mi">40</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A70&#39;</span> <span class="k">THEN</span> <span class="mi">25</span>
                   <span class="k">WHEN</span> <span class="n">fcc</span><span class="o">=</span><span class="s1">&#39;A69&#39;</span> <span class="k">THEN</span> <span class="mi">15</span>
                   <span class="k">ELSE</span> <span class="k">null</span> <span class="k">END</span><span class="p">;</span>

<span class="c1">-- UPDATE the cost information based on oneway streets</span>

<span class="k">UPDATE</span> <span class="n">edge_table</span> <span class="k">SET</span>
    <span class="n">cost_time</span> <span class="o">=</span> <span class="k">CASE</span>
        <span class="k">WHEN</span> <span class="n">one_way</span><span class="o">=</span><span class="s1">&#39;TF&#39;</span> <span class="k">THEN</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span>
        <span class="k">ELSE</span> <span class="n">cost_len</span><span class="o">/</span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">speed_kmh</span><span class="p">::</span><span class="nb">numeric</span><span class="o">*</span><span class="mi">3600</span><span class="p">.</span><span class="mi">0</span>
        <span class="k">END</span><span class="p">,</span>
    <span class="n">rcost_time</span> <span class="o">=</span> <span class="k">CASE</span>
        <span class="k">WHEN</span> <span class="n">one_way</span><span class="o">=</span><span class="s1">&#39;FT&#39;</span> <span class="k">THEN</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">0</span>
        <span class="k">ELSE</span> <span class="n">cost_len</span><span class="o">/</span><span class="mi">1000</span><span class="p">.</span><span class="mi">0</span><span class="o">/</span><span class="n">speed_kmh</span><span class="p">::</span><span class="nb">numeric</span><span class="o">*</span><span class="mi">3600</span><span class="p">.</span><span class="mi">0</span>
        <span class="k">END</span><span class="p">;</span>

<span class="c1">-- clean up the database because we have updated a lot of records</span>

<span class="k">VACUUM</span> <span class="k">ANALYZE</span> <span class="k">VERBOSE</span> <span class="n">edge_table</span><span class="p">;</span>
</pre></div>
</div>
<p>Now your database should be ready to use any (most?) of the pgRouting algorithms.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="pgr_createTopology.html#pgr-create-topology"><em>pgr_createTopology</em></a></li>
<li><a class="reference internal" href="pgr_nodeNetwork.html#pgr-node-network"><em>pgr_nodeNetwork</em></a></li>
</ul>
<div class="section" id="graph-analytics">
<span id="analytics"></span><h3>Graph Analytics<a class="headerlink" href="#graph-analytics" title="Permalink to this headline">¶</a></h3>
<p class="rubric">Overview</p>
<p>It is common to find problems with graphs that have not been constructed fully noded or in graphs with z-levels at intersection that have been entered incorrectly. An other problem is one way streets that have been entered in the wrong direction. We can not detect errors with respect to &#8220;ground&#8221; truth, but we can look for inconsistencies and some anomalies in a graph and report them for additional inspections.</p>
<p>We do not current have any visualization tools for these problems, but I have used mapserver to render the graph and highlight potential problem areas. Someone familiar with graphviz might contribute tools for generating images with that.</p>
</div>
<div class="section" id="analyze-a-graph">
<h3>Analyze a Graph<a class="headerlink" href="#analyze-a-graph" title="Permalink to this headline">¶</a></h3>
<p>With <a class="reference internal" href="pgr_analyzeGraph.html#pgr-analyze-graph"><em>pgr_analyzeGraph</em></a> the graph can be checked for errors. For example for table &#8220;mytab&#8221; that has &#8220;mytab_vertices_pgr&#8221; as the vertices table:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">pgr_analyzeGraph</span><span class="p">(</span><span class="s1">&#39;mytab&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">000002</span><span class="p">);</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Performing</span> <span class="n">checks</span><span class="p">,</span> <span class="n">pelase</span> <span class="n">wait</span><span class="p">...</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Analyzing</span> <span class="k">for</span> <span class="n">dead</span> <span class="n">ends</span><span class="p">.</span> <span class="n">Please</span> <span class="n">wait</span><span class="p">...</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Analyzing</span> <span class="k">for</span> <span class="n">gaps</span><span class="p">.</span> <span class="n">Please</span> <span class="n">wait</span><span class="p">...</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Analyzing</span> <span class="k">for</span> <span class="n">isolated</span> <span class="n">edges</span><span class="p">.</span> <span class="n">Please</span> <span class="n">wait</span><span class="p">...</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Analyzing</span> <span class="k">for</span> <span class="n">ring</span> <span class="n">geometries</span><span class="p">.</span> <span class="n">Please</span> <span class="n">wait</span><span class="p">...</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Analyzing</span> <span class="k">for</span> <span class="n">intersections</span><span class="p">.</span> <span class="n">Please</span> <span class="n">wait</span><span class="p">...</span>
<span class="n">NOTICE</span><span class="p">:</span>              <span class="n">ANALYSIS</span> <span class="n">RESULTS</span> <span class="k">FOR</span> <span class="n">SELECTED</span> <span class="n">EDGES</span><span class="p">:</span>
<span class="n">NOTICE</span><span class="p">:</span>                    <span class="n">Isolated</span> <span class="n">segments</span><span class="p">:</span> <span class="mi">158</span>
<span class="n">NOTICE</span><span class="p">:</span>                            <span class="n">Dead</span> <span class="n">ends</span><span class="p">:</span> <span class="mi">20028</span>
<span class="n">NOTICE</span><span class="p">:</span>  <span class="n">Potential</span> <span class="n">gaps</span> <span class="k">found</span> <span class="n">near</span> <span class="n">dead</span> <span class="n">ends</span><span class="p">:</span> <span class="mi">527</span>
<span class="n">NOTICE</span><span class="p">:</span>               <span class="n">Intersections</span> <span class="n">detected</span><span class="p">:</span> <span class="mi">2560</span>
<span class="n">NOTICE</span><span class="p">:</span>                      <span class="n">Ring</span> <span class="n">geometries</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">pgr_analyzeGraph</span>
<span class="c1">----------</span>
   <span class="n">OK</span>
<span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>
</pre></div>
</div>
<p>In the vertices table &#8220;mytab_vertices_pgr&#8221;:</p>
<blockquote>
<div><ul class="simple">
<li>Deadends are identified by <tt class="docutils literal"><span class="pre">cnt=1</span></tt></li>
<li>Potencial gap problems are identified with <tt class="docutils literal"><span class="pre">chk=1</span></tt>.</li>
</ul>
</div></blockquote>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">deadends</span>  <span class="k">FROM</span> <span class="n">mytab_vertices_pgr</span> <span class="k">WHERE</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">deadends</span>
<span class="c1">----------</span>
    <span class="mi">20028</span>
 <span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>

<span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">gaps</span>  <span class="k">FROM</span> <span class="n">mytab_vertices_pgr</span> <span class="k">WHERE</span> <span class="n">chk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
 <span class="n">gaps</span>
 <span class="c1">-----</span>
   <span class="mi">527</span>
 <span class="p">(</span><span class="mi">1</span> <span class="k">row</span><span class="p">)</span>
</pre></div>
</div>
<p>For isolated road segments, for example, a segment where both ends are deadends. you can find these with the following query:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="n">mytab</span> <span class="n">a</span><span class="p">,</span> <span class="n">mytab_vertices_pgr</span> <span class="n">b</span><span class="p">,</span> <span class="n">mytab_vertices_pgr</span> <span class="k">c</span>
    <span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="k">source</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">id</span> <span class="k">AND</span> <span class="n">b</span><span class="p">.</span><span class="n">cnt</span><span class="o">=</span><span class="mi">1</span> <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">target</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="k">AND</span> <span class="k">c</span><span class="p">.</span><span class="n">cnt</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>If you want to visualize these on a graphic image, then you can use something like mapserver to render the edges and the vertices and style based on <tt class="docutils literal"><span class="pre">cnt</span></tt> or if they are isolated, etc. You can also do this with a tool like graphviz, or geoserver or other similar tools.</p>
</div>
<div class="section" id="analyze-one-way-streets">
<h3>Analyze One Way Streets<a class="headerlink" href="#analyze-one-way-streets" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="pgr_analyzeOneWay.html#pgr-analyze-oneway"><em>pgr_analyzeOneway</em></a> analyzes one way streets in a graph and identifies any flipped segments. Basically if you count the edges coming into a node and the edges exiting a node the number has to be greater than one.</p>
<p>This query will add two columns to the vertices_tmp table <tt class="docutils literal"><span class="pre">ein</span> <span class="pre">int</span></tt> and <tt class="docutils literal"><span class="pre">eout</span> <span class="pre">int</span></tt> and populate it with the appropriate counts. After running this on a graph you can identify nodes with potential problems with the following query.</p>
<p>The rules are defined as an array of text strings that if match the <tt class="docutils literal"><span class="pre">col</span></tt> value would be counted as true for the source or target in or out condition.</p>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Lets assume we have a table &#8220;st&#8221; of edges and a column &#8220;one_way&#8221; that might have values like:</p>
<blockquote>
<div><ul class="simple">
<li>&#8216;FT&#8217;    - oneway from the source to the target node.</li>
<li>&#8216;TF&#8217;    - oneway from the target to the source node.</li>
<li>&#8216;B&#8217;     - two way street.</li>
<li>&#8216;&#8217;      - empty field, assume twoway.</li>
<li>&lt;NULL&gt;  - NULL field, use two_way_if_null flag.</li>
</ul>
</div></blockquote>
<p>Then we could form the following query to analyze the oneway streets for errors.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">pgr_analyzeOneway</span><span class="p">(</span><span class="s1">&#39;mytab&#39;</span><span class="p">,</span>
            <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;TF&#39;</span><span class="p">],</span>
            <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;FT&#39;</span><span class="p">],</span>
            <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;FT&#39;</span><span class="p">],</span>
            <span class="nb">ARRAY</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;TF&#39;</span><span class="p">],</span>
            <span class="p">);</span>

<span class="c1">-- now we can see the problem nodes</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytab_vertices_pgr</span> <span class="k">WHERE</span> <span class="n">ein</span><span class="o">=</span><span class="mi">0</span> <span class="k">OR</span> <span class="n">eout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">-- and the problem edges connected to those nodes</span>
<span class="k">SELECT</span> <span class="n">gid</span> <span class="k">FROM</span> <span class="n">mytab</span> <span class="n">a</span><span class="p">,</span> <span class="n">mytab_vertices_pgr</span> <span class="n">b</span> <span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="k">source</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">id</span> <span class="k">AND</span> <span class="n">ein</span><span class="o">=</span><span class="mi">0</span> <span class="k">OR</span> <span class="n">eout</span><span class="o">=</span><span class="mi">0</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">gid</span> <span class="k">FROM</span> <span class="n">mytab</span> <span class="n">a</span><span class="p">,</span> <span class="n">mytab_vertices_pgr</span> <span class="n">b</span> <span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">target</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="n">id</span> <span class="k">AND</span> <span class="n">ein</span><span class="o">=</span><span class="mi">0</span> <span class="k">OR</span> <span class="n">eout</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Typically these problems are generated by a break in the network, the one way direction set wrong, maybe an error related to z-levels or a network that is not properly noded.</p>
<p>The above tools do not detect all network issues, but they will identify some common problems. There are other problems that are hard to detect because they are more global in nature like multiple disconnected networks. Think of an island with a road network that is not connected to the mainland network because the bridge or ferry routes are missing.</p>
</div>
</div>
<div class="section" id="id6">
<h2>See Also<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="pgr_analyzeGraph.html#pgr-analyze-graph"><em>pgr_analyzeGraph</em></a></li>
<li><a class="reference internal" href="pgr_analyzeOneWay.html#pgr-analyze-oneway"><em>pgr_analyzeOneway</em></a></li>
<li><a class="reference internal" href="pgr_nodeNetwork.html#pgr-node-network"><em>pgr_nodeNetwork</em></a></li>
</ul>
</div>
</div>
<div class="section" id="performance-tips">
<span id="performance"></span><h1>Performance Tips<a class="headerlink" href="#performance-tips" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To get faster results bound your queries to the area of interest of routing to have, for example, no more than one million rows.</p>
</div>
<p>When &#8220;you know&#8221; that you are going to remove a set of edges from the edges table, and without those edges you are going to use a routing function you can do the following:</p>
<p>Analize the new topology based on the actual topology:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="n">pgr_analyzegraph</span><span class="p">(</span><span class="s1">&#39;edge_table&#39;</span><span class="p">,</span><span class="n">rows_where</span><span class="p">:</span><span class="o">=</span><span class="s1">&#39;id &lt; 17&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Or create a new topology if the change is permanent:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="n">pgr_createTopology</span><span class="p">(</span><span class="s1">&#39;edge_table&#39;</span><span class="p">,</span><span class="n">rows_where</span><span class="p">:</span><span class="o">=</span><span class="s1">&#39;id &lt; 17&#39;</span><span class="p">);</span>
<span class="n">pgr_analyzegraph</span><span class="p">(</span><span class="s1">&#39;edge_table&#39;</span><span class="p">,</span><span class="n">rows_where</span><span class="p">:</span><span class="o">=</span><span class="s1">&#39;id &lt; 17&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Use an SQL that &#8220;removes&#8221; the edges in the routing function</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">target</span> <span class="k">from</span> <span class="n">edge_table</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">17</span>
</pre></div>
</div>
<p>When &#8220;you know&#8221; that the route will not go out of a particular area, to speed up the process you can use a more complex SQL query like</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">target</span> <span class="k">from</span> <span class="n">edge_table</span> <span class="k">WHERE</span>
        <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">17</span> <span class="k">and</span>
        <span class="n">the_geom</span>  <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">select</span> <span class="n">st_buffer</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">myarea</span> <span class="k">FROM</span>  <span class="n">edge_table</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the  same condition <tt class="docutils literal"><span class="pre">id</span> <span class="pre">&lt;</span> <span class="pre">17</span></tt> is used in all cases.</p>
</div>
<div class="section" id="user-s-recipes-list">
<span id="recipes"></span><h1>User&#8217;s Recipes List<a class="headerlink" href="#user-s-recipes-list" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<p><em>No more contributions</em></p>
</div>
<div class="section" id="how-to-contribute">
<h1>How to contribute.<a class="headerlink" href="#how-to-contribute" title="Permalink to this headline">¶</a></h1>
<p class="rubric">To add a recipie or a wrapper</p>
<p>The first steps are:</p>
<blockquote>
<div><ul class="simple">
<li>Fork the repository</li>
<li>Create a branch for your recipe or wrapper</li>
<li>Create your recipe file</li>
</ul>
</div></blockquote>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>doc/src/recipes/
vi myrecipe.rst
git add myrecipe.rst
<span class="c"># include the recipe in this file</span>
vi index.rst
</pre></div>
</div>
<p class="rubric">To create the test file of your recipe</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd test</span>
cp myrecipe.rst myrecipe.sql.test

<span class="c"># make your test based on your recipe</span>
vi myrecipe.sql.test
git add myrecipe.sql.test

<span class="c"># create your test results file</span>
touch myrecipe.result
git add myrecipe.result

<span class="c"># add your test to the file</span>
vi test.conf
</pre></div>
</div>
<p>Leave only the SQL code on <tt class="docutils literal"><span class="pre">myrecipe.sql.test</span></tt> by deleting lines or by commenting lines.</p>
<p class="rubric">To get the results of your recipe</p>
<p>From the root directory execute:</p>
<div class="highlight-bash"><div class="highlight"><pre>tools/test-runner.pl -alg recipes -ignorenotice
</pre></div>
</div>
<p>Copy the results of your recipe and paste them in the file <tt class="docutils literal"><span class="pre">myrecipe.result</span></tt>, and remove the &#8220;&gt; &#8221; from the file.</p>
<p class="rubric">make a pull request.</p>
<div class="highlight-bash"><div class="highlight"><pre>git commit -a -m <span class="s1">&#39;myrecipe is for this and that&#39;</span>
git push
</pre></div>
</div>
<p>From your fork in github make a pull request over develop</p>
<div class="section" id="comparing-topology-of-a-unnoded-network-with-a-noded-network">
<span id="example-recipe"></span><h2>Comparing topology of a unnoded network with a noded network<a class="headerlink" href="#comparing-topology-of-a-unnoded-network-with-a-noded-network" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">pgRouting team.</td>
</tr>
<tr class="field-even field"><th class="field-name">Licence:</th><td class="field-body">Open Source</td>
</tr>
</tbody>
</table>
<p>This recipe uses the <a class="reference internal" href="sampledata.html#sampledata"><em>Sample Data</em></a> network.</p>
<p>The purpose of this recipe is to compare a not nodded network with a nodded network.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">pgr_createTopology</span><span class="p">(</span><span class="s1">&#39;edge_table&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">pgr_analyzegraph</span><span class="p">(</span><span class="s1">&#39;edge_table&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">pgr_nodeNetwork</span><span class="p">(</span><span class="s1">&#39;edge_table&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">pgr_createTopology</span><span class="p">(</span><span class="s1">&#39;edge_table_noded&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">pgr_analyzegraph</span><span class="p">(</span><span class="s1">&#39;edge_table_noded&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="handling-parallels-after-getting-a-path-pgr-ksp-focus">
<span id="parallel-handling"></span><h2>Handling parallels after getting a path (pgr_ksp focus)<a class="headerlink" href="#handling-parallels-after-getting-a-path-pgr-ksp-focus" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">pgRouting team.</td>
</tr>
<tr class="field-even field"><th class="field-name">Licence:</th><td class="field-body">Open Source</td>
</tr>
</tbody>
</table>
<p class="rubric">The graph</p>
<img alt="_images/parallelImage.png" src="_images/parallelImage.png" />
<p class="rubric">Data</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">drop</span> <span class="k">table</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">parallel</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">parallel</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">serial</span><span class="p">,</span>
  <span class="k">source</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">target</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">cost</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
  <span class="n">reverse_cost</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
  <span class="n">x1</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
  <span class="n">y1</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
  <span class="n">x2</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
  <span class="n">y2</span> <span class="n">double</span> <span class="k">precision</span><span class="p">,</span>
  <span class="n">the_geom</span> <span class="n">geometry</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">parallel</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
  <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">parallel</span> <span class="k">SET</span> <span class="n">the_geom</span> <span class="o">=</span> <span class="n">ST_makeline</span><span class="p">(</span><span class="n">ST_point</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">),</span><span class="n">ST_point</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">));</span>
<span class="k">UPDATE</span> <span class="n">parallel</span> <span class="k">SET</span> <span class="n">the_geom</span> <span class="o">=</span> <span class="n">ST_makeline</span><span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span><span class="n">ST_point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ST_point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">ST_point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">parallel</span> <span class="k">SET</span> <span class="n">the_geom</span> <span class="o">=</span> <span class="n">ST_makeline</span><span class="p">(</span><span class="nb">ARRAY</span><span class="p">[</span><span class="n">ST_point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ST_point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ST_point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">ST_point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
                              <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">parallel</span> <span class="k">SET</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">ST_length</span><span class="p">(</span><span class="n">the_geom</span><span class="p">),</span> <span class="n">reverse_cost</span> <span class="o">=</span> <span class="n">ST_length</span><span class="p">(</span><span class="n">the_geom</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">pgr_createTopology</span><span class="p">(</span><span class="s1">&#39;parallel&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="p">);</span>
</pre></div>
</div>
<p class="rubric">pgr_ksp results</p>
<p>We ignore the costs because we want all the parallels</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">seq</span><span class="p">,</span> <span class="n">path_id</span> <span class="k">AS</span> <span class="n">route</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edge</span> <span class="k">INTO</span> <span class="n">routes</span>
  <span class="k">from</span> <span class="n">pgr_ksp</span><span class="p">(</span><span class="s1">&#39;select id, source, target, cost, reverse_cost from parallel&#39;</span><span class="p">,</span>
  <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="k">select</span> <span class="n">route</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edge</span> <span class="k">from</span> <span class="n">routes</span><span class="p">;</span>
  <span class="n">route</span> <span class="o">|</span> <span class="n">node</span> <span class="o">|</span> <span class="n">edge</span>
 <span class="c1">-------+------+------</span>
      <span class="mi">1</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>    <span class="mi">1</span>
      <span class="mi">1</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>    <span class="mi">2</span>
      <span class="mi">1</span> <span class="o">|</span>    <span class="mi">3</span> <span class="o">|</span>    <span class="mi">5</span>
      <span class="mi">1</span> <span class="o">|</span>    <span class="mi">4</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>    <span class="mi">1</span>
      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>    <span class="mi">6</span>
      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">5</span> <span class="o">|</span>    <span class="mi">7</span>
      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">6</span> <span class="o">|</span>    <span class="mi">8</span>
      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">3</span> <span class="o">|</span>    <span class="mi">5</span>
      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">4</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
 <span class="p">(</span><span class="mi">10</span> <span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">We need an aggregate function:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">AGGREGATE</span> <span class="n">array_accum</span> <span class="p">(</span><span class="n">anyelement</span><span class="p">)</span>
<span class="p">(</span>
  <span class="n">sfunc</span> <span class="o">=</span> <span class="n">array_append</span><span class="p">,</span>
  <span class="k">stype</span> <span class="o">=</span> <span class="n">anyarray</span><span class="p">,</span>
  <span class="n">initcond</span> <span class="o">=</span> <span class="s1">&#39;{}&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
<p class="rubric">Now lets generate a table with the parallel edges.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="k">distinct</span> <span class="n">seq</span><span class="p">,</span><span class="n">route</span><span class="p">,</span><span class="k">source</span><span class="p">,</span><span class="n">target</span><span class="p">,</span> <span class="n">array_accum</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">edges</span> <span class="k">into</span> <span class="n">paths</span>
  <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="n">seq</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">target</span>
        <span class="k">from</span> <span class="n">parallel</span><span class="p">,</span> <span class="n">routes</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="n">edge</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span>
     <span class="k">join</span> <span class="n">parallel</span> <span class="k">using</span> <span class="p">(</span><span class="k">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
  <span class="k">group</span> <span class="k">by</span> <span class="n">seq</span><span class="p">,</span><span class="n">route</span><span class="p">,</span><span class="k">source</span><span class="p">,</span><span class="n">target</span> <span class="k">order</span> <span class="k">by</span> <span class="n">seq</span><span class="p">;</span>

 <span class="k">select</span> <span class="n">route</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">edges</span> <span class="k">from</span> <span class="n">paths</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre> route | source | target |  edges
-------+--------+--------+---------
     1 |      1 |      2 | {1}
     2 |      1 |      2 | {1}
     2 |      2 |      5 | {6}
     1 |      2 |      3 | {2,3,4}
     2 |      5 |      6 | {7}
     1 |      3 |      4 | {5}
     2 |      6 |      3 | {8}
     2 |      3 |      4 | {5}
(8 rows)
</pre></div>
</div>
<p class="rubric">Some more aggregate functions</p>
<p>To generate a table with all the combinations for parallel routes, we need some more aggregates</p>
<div class="highlight-python"><div class="highlight"><pre>create or replace function multiply( integer, integer )
returns integer as
$$
  select $1 * $2;
$$
language sql stable;

create aggregate prod(integer)
(
  sfunc = multiply,
  stype = integer,
  initcond = 1
);
</pre></div>
</div>
<p class="rubric">And a function that &#8220;Expands&#8221; the table</p>
<div class="highlight-sql"><div class="highlight"><pre>CREATE OR REPLACE function   expand_parallel_edge_paths(tab text)
  returns TABLE (
                seq    INTEGER,
                route  INTEGER,
                source INTEGER, target INTEGER, -- this ones are not really needed
                edge   INTEGER ) AS
 $body$
 DECLARE
 nroutes   INTEGER;
 newroutes INTEGER;
 rec   record;
 seq2 INTEGER := 1;
 rnum INTEGER := 0;

 BEGIN     -- get the number of distinct routes
   execute &#39;select count(DISTINCT route) from &#39; || tab INTO nroutes;
   FOR i IN 0..nroutes-1
   LOOP
       -- compute the number of new routes this route will expand into
       -- this is the product of the lengths of the edges array for each route
       execute &#39;select prod(array_length(edges, 1))-1 from &#39;
       ||       quote_ident(tab) || &#39; where route=&#39;    || i INTO newroutes;
       -- now we generate the number of new routes for this route
       -- by repeatedly listing the route and swapping out the parallel edges
       FOR j IN 0..newroutes
       LOOP
           -- query the specific route
           FOR rec IN execute &#39;select * from &#39; || quote_ident(tab) ||&#39; where route=&#39; || i
                       || &#39; order by seq&#39;
           LOOP
               seq := seq2;
               route := rnum;
               source := rec.source;
               target := rec.target;
               -- using module arithmetic iterate through the various edge choices
               edge := rec.edges[(j % (array_length(rec.edges, 1)))+1];
               -- return a new record
               RETURN next;
               seq2 := seq2 + 1;    -- increment the record count
            END LOOP;
            seq := seq2;
            route := rnum;
            source := rec.target;
            target := -1;
            edge := -1;
            RETURN next;  -- Insert the ending record of the route
            seq2 := seq2 + 1;

            rnum := rnum + 1;  -- increment the route count
        END LOOP;
     END LOOP;
 END;
 $body$
 language plpgsql volatile strict   cost 100 rows 100;
</pre></div>
</div>
<p class="rubric">Test it</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">expand_parallel_edge_paths</span><span class="p">(</span> <span class="s1">&#39;paths&#39;</span> <span class="p">);</span>
 <span class="n">seq</span> <span class="o">|</span> <span class="n">route</span> <span class="o">|</span> <span class="k">source</span> <span class="o">|</span> <span class="n">target</span> <span class="o">|</span> <span class="n">edge</span>
<span class="c1">-----+-------+--------+--------+------</span>
   <span class="mi">1</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">1</span>
   <span class="mi">2</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">2</span>
   <span class="mi">3</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>    <span class="mi">5</span>
   <span class="mi">4</span> <span class="o">|</span>     <span class="mi">0</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
   <span class="mi">5</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">1</span>
   <span class="mi">6</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">3</span>
   <span class="mi">7</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>    <span class="mi">5</span>
   <span class="mi">8</span> <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
   <span class="mi">9</span> <span class="o">|</span>     <span class="mi">2</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">1</span>
  <span class="mi">10</span> <span class="o">|</span>     <span class="mi">2</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">4</span>
  <span class="mi">11</span> <span class="o">|</span>     <span class="mi">2</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>    <span class="mi">5</span>
  <span class="mi">12</span> <span class="o">|</span>     <span class="mi">2</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
  <span class="mi">13</span> <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>      <span class="mi">1</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>    <span class="mi">1</span>
  <span class="mi">14</span> <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>      <span class="mi">2</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>    <span class="mi">6</span>
  <span class="mi">15</span> <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>      <span class="mi">5</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>    <span class="mi">7</span>
  <span class="mi">16</span> <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>      <span class="mi">6</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>    <span class="mi">8</span>
  <span class="mi">17</span> <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>      <span class="mi">3</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>    <span class="mi">5</span>
  <span class="mi">18</span> <span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span>      <span class="mi">4</span> <span class="o">|</span>     <span class="o">-</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">-</span><span class="mi">1</span>
<span class="p">(</span><span class="mi">18</span> <span class="k">rows</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="developer-s-guide">
<span id="developer"></span><h1>Developer&#8217;s Guide<a class="headerlink" href="#developer-s-guide" title="Permalink to this headline">¶</a></h1>
<p>This contains some basic comments about developing.
More detailed information can be found on:</p>
<p><a class="reference external" href="http://docs.pgrouting.org/doxy/2.4/index.html">http://docs.pgrouting.org/doxy/2.4/index.html</a></p>
<div class="section" id="source-tree-layout">
<h2>Source Tree Layout<a class="headerlink" href="#source-tree-layout" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><em>cmake/</em></dt>
<dd>cmake scripts used as part of our build system.</dd>
<dt><em>src/</em></dt>
<dd>This is the algorithm source tree. Each algorithm is to be contained
in its on sub-tree with /doc, /sql, /src, and /test sub-directories.</dd>
</dl>
<p>For example:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">src/dijkstra</span></tt>  Main direcotry for dijkstra algorithm.</li>
<li><tt class="docutils literal"><span class="pre">src/dijkstra/doc</span></tt>  Dijkstra&#8217;s documentation directory.</li>
<li><tt class="docutils literal"><span class="pre">src/dijkstra/src</span></tt>  Dijkstra&#8217;s C and/or C++ code.</li>
<li><tt class="docutils literal"><span class="pre">src/dijkstra/sql</span></tt>  Dijkstra&#8217;s sql code.</li>
<li><tt class="docutils literal"><span class="pre">src/dijkstra/test</span></tt>  Dijkstra&#8217;s tests.</li>
<li><tt class="docutils literal"><span class="pre">src/dijkstra/test/pgtap</span></tt>  Dijkstra&#8217;s pgTaptests.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="tools">
<h2>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><em>tools/</em></dt>
<dd>Miscellaneous scripts and tools.</dd>
</dl>
<p>To keep version/branch/commit up to date install pelase do the following:</p>
<div class="highlight-bash"><div class="highlight"><pre>cp tools/pre-commit .git/hooks/pre-commit
</pre></div>
</div>
<p>After each commit a the file <strong>VERSION</strong> will remain. (The hash number will be one behind)</p>
<p>To use doxygen:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>tools/doxygen/
make
</pre></div>
</div>
<p>The code&#8217;s documentation can be found in:</p>
<div class="highlight-bash"><div class="highlight"><pre>build/doxy/html/index.html
</pre></div>
</div>
<p>We try to follow the following guidelines for C++ coding:</p>
<p><a class="reference external" href="https://google-styleguide.googlecode.com/svn/trunk/cppguide.html">https://google-styleguide.googlecode.com/svn/trunk/cppguide.html</a></p>
<p>Sample use:</p>
<div class="highlight-bash"><div class="highlight"><pre>python cpplint.py ../src/dijkstra/src/dijkstra_driver.h
../src/dijkstra/src/dijkstra_driver.h:34:  Lines should be &lt;<span class="o">=</span> 80 characters long  <span class="o">[</span>whitespace/line_length<span class="o">]</span> <span class="o">[</span>2<span class="o">]</span>
../src/dijkstra/src/dijkstra_driver.h:40:  Line ends in whitespace.  Consider deleting these extra spaces.  <span class="o">[</span>whitespace/end_of_line<span class="o">]</span> <span class="o">[</span>4<span class="o">]</span>
Done processing ../src/dijkstra/src/dijkstra_driver.h
Total errors found: 2
</pre></div>
</div>
<ul class="simple">
<li>Maybe line 34 is a very complicated calculation so you can just ignore the message</li>
<li>Delete whitespace at end of line is easy fix.</li>
<li>Use your judgement!!!</li>
</ul>
<p>Some files like <tt class="docutils literal"><span class="pre">postgres.h</span></tt> are system dependent so don&#8217;t include the directory.</p>
<dl class="docutils">
<dt>Tools like:</dt>
<dd><ul class="first last simple">
<li>doit</li>
<li>winnie</li>
<li>publish_doc.sh</li>
</ul>
</dd>
</dl>
<p>are very specific for the deployment of new versions, so please ask first!</p>
</div>
<div class="section" id="documentation-layout">
<h2>Documentation Layout<a class="headerlink" href="#documentation-layout" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All documentation should be in reStructuredText format.
See: &lt;<a class="reference external" href="http://docutils.sf.net/rst.html">http://docutils.sf.net/rst.html</a>&gt; for introductory docs.</p>
</div>
<p>Documentation is distributed into the source tree. This top level &#8220;doc&#8221;
directory is intended for high level documentation cover subjects like:</p>
<blockquote>
<div><ul class="simple">
<li>Compiling and testing</li>
<li>Installation</li>
<li>Tutorials</li>
<li>Users&#8217; Guide front materials</li>
<li>Reference Manual front materials</li>
<li>etc</li>
</ul>
</div></blockquote>
<p>Since the algorithm specific documentation is contained in the source
tree with the algorithm specific files, the process of building the
documentation and publishing it will need to assemble the details with
the front material as needed.</p>
<p>Also, to keep the &#8220;doc&#8221; directory from getting cluttered, each major book
like those listed above, should be contained in a separate directory under
&#8220;doc&#8221;. Any images or other materials related to the book should also be kept
in that directory.</p>
<p>Tests are part of the tree layout:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">src/dijkstra/test</span></tt>  Dijkstra&#8217;s tests.<ul>
<li><tt class="docutils literal"><span class="pre">test.conf</span></tt>  Configuration file.</li>
<li><tt class="docutils literal"><span class="pre">&lt;name&gt;.test.sql</span></tt>  Test file</li>
<li><tt class="docutils literal"><span class="pre">&lt;name&gt;.result</span></tt>  Results file bash</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">src/dijkstra/test/pgtap</span></tt>  Dijkstra&#8217;s pgTaptests.<ul>
<li><tt class="docutils literal"><span class="pre">&lt;name&gt;.sql</span></tt> pgTap test file</li>
</ul>
</li>
</ul>
</div></blockquote>
<p class="rubric">Testing</p>
<p>Testing is executed from the top level of the tree layout:</p>
<div class="highlight-bash"><div class="highlight"><pre>tools/testers/algorithm-tester.pl
createdb  -U &lt;user&gt; ___pgr___test___
sh ./tools/testers/pg_prove_tests.sh &lt;user&gt;
dropdb  -U &lt;user&gt; ___pgr___test___
</pre></div>
</div>
<p class="rubric">Indices and tables</p>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright pgRouting Contributors - Version v2.4.0-dev.<br/>
      Last updated on Mar 16, 2017.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>