BEGIN;
BEGIN
SET client_min_messages TO NOTICE;
SET
UPDATE edge_table SET cost = cost + 0.001 * id * id, reverse_cost = reverse_cost + 0.001 * id * id;
UPDATE 18
/*
-- GRAPH 1 <=> 2
-- EXPECTED
--   empty
*/
SELECT * FROM pgr_contractGraph(
    $$SELECT id, source, target, cost, reverse_cost FROM edge_table
    WHERE id IN (1)$$,
    ARRAY[2]::integer[], 1, ARRAY[]::BIGINT[], true);
 seq | type | id | contracted_vertices | source | target | cost
-----+------+----+---------------------+--------+--------+------
(0 rows)

/*
-- GRAPH 4->3->6
-- EXPECTED
-- 1 | e    | -1 | {3}                 |      4 |      6 |    2
-- New edges:  4->6
*/
SELECT * FROM pgr_contractGraph(
    $$SELECT id, source, target, cost, reverse_cost FROM edge_table
    WHERE id IN (3, 5)$$,
    ARRAY[2]::integer[], 1, ARRAY[]::BIGINT[], true);
 seq | type | id | contracted_vertices | source | target | cost
-----+------+----+---------------------+--------+--------+-------
   1 | e    | -2 | {3}                 |      4 |      6 | 2.034
(1 row)

/*
-- GRAPH 10 <=> 5 <=> 6
-- EXPECTED
--   1 | e    | -1 | {5}                 |      6 |     10 |    2
--   2 | e    | -2 | {5}                 |     10 |      6 |    2
-- New edges:  6 <=> 10
*/
SELECT * FROM pgr_contractGraph(
    $$SELECT id, source, target, cost, reverse_cost FROM edge_table
    WHERE id IN (8, 10)$$,
    ARRAY[2]::integer[], 1, ARRAY[]::BIGINT[], true);
 seq | type | id | contracted_vertices | source | target | cost
-----+------+----+---------------------+--------+--------+-------
   1 | e    | -2 | {5}                 |      6 |     10 | 2.164
   2 | e    | -3 | {5}                 |     10 |      6 | 2.164
(2 rows)

-- TODO fix Wrong Result
/*
-- GRAPH 3 -> 2 <=> 5
-- EXPECTED
--   1 | e    | -1 | {2}                 |      3 |      5 |    2
-- New edges:  3 -> 5
-- New graph: 3 ->{2}  5 -> 2
-- vertex 2 becomes a dead end
*/
SELECT * FROM pgr_contractGraph(
    $$SELECT id, source, target, cost, reverse_cost FROM edge_table
    WHERE id IN (2, 4)$$,
    ARRAY[2]::integer[], 1, ARRAY[]::BIGINT[], true);
 seq | type | id | contracted_vertices | source | target | cost
-----+------+----+---------------------+--------+--------+------
(0 rows)

-- TODO fix Wrong Result
/*
-- GRAPH 3 -> 6 <=> 9
-- EXPECTED
--   1 | e    | -1 | {6}                 |      3 |      9 |    2
-- New edges:  3 -> 5
-- New graph: 3 ->{6}  9 -> 6
-- vertex 6 becomes a dead end
*/
SELECT * FROM pgr_contractGraph(
    $$SELECT id, source, target, cost, reverse_cost FROM edge_table
    WHERE id IN (5, 9)$$,
    ARRAY[2]::integer[], 1, ARRAY[]::BIGINT[], true);
 seq | type | id | contracted_vertices | source | target | cost
-----+------+----+---------------------+--------+--------+------
(0 rows)

/*
-- GRAPH (all graph)
-- EXPECTED
--   1 | e    | -1 | {8}                 |      5 |      7 |    2
--   1 | e    | -1 | {8}                 |      7 |      5 |    2
-- New edges:  3 <=> 5
-- New graph: edges 6 & 7 removed in both ways
-- vertex 6 becomes a dead end
*/
SELECT * FROM pgr_contractGraph(
    $$SELECT id, source, target, cost, reverse_cost FROM edge_table$$,
    ARRAY[2]::integer[], 1, ARRAY[]::BIGINT[], true);
 seq | type | id | contracted_vertices | source | target | cost
-----+------+----+---------------------+--------+--------+-------
   1 | e    | -3 | {8}                 |      5 |      7 | 2.085
   2 | e    | -2 | {8}                 |      7 |      5 | 2.085
(2 rows)

/*
-- GRAPH
--       5 <=> 6
--       ||    -|
--       2 <-  3
-- EXPECTED
--   1 | e    | -1 | {5}                 |      2 |      6 |    2
--   2 | e    | -1 | {5}                 |      6 |      2 |    2
-- New edges:  2 <=> 6
-- New graph:
--       ===== 6
--       ||    -|
--       2 <-  3
*/
SELECT * FROM pgr_contractGraph(
    $$SELECT id, source, target, cost, reverse_cost FROM edge_table
    WHERE id IN (2, 4, 5, 8)$$,
    ARRAY[2]::integer[], 1, ARRAY[]::BIGINT[], true);
 seq | type | id | contracted_vertices | source | target | cost
-----+------+----+---------------------+--------+--------+------
   1 | e    | -2 | {5}                 |      2 |      6 | 2.08
   2 | e    | -3 | {5}                 |      6 |      2 | 2.08
(2 rows)

ROLLBACK;
ROLLBACK
