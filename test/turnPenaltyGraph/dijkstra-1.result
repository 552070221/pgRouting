BEGIN;
BEGIN
SET client_min_messages TO NOTICE;
SET
UPDATE edge_table SET id = id * 100, source = 1000 * source, target = 1000 * target;
UPDATE 18
UPDATE edge_table_vertices_pgr SET id = id * 1000;
UPDATE 17
SELECT  *, 0 AS edge  INTO result1 FROM pgr_turnPenaltyGraph(
    $$SELECT id, source, target, cost, reverse_cost
    FROM edge_table
    WHERE id = 100$$
);
SELECT 4
SELECT * FROM result1;
 seq | source | target | cost | original_source_vertex | original_source_edge | original_target_vertex | original_target_edge | edge 
-----+--------+--------+------+------------------------+----------------------+------------------------+----------------------+------
   1 |      1 |      4 |    1 |                   1000 |                  100 |                   2000 |                  100 |    0
   2 |      2 |      1 |    0 |                   1000 |                 -100 |                   1000 |                  100 |    0
   3 |      3 |      2 |    1 |                   2000 |                 -100 |                   1000 |                 -100 |    0
   4 |      4 |      3 |    0 |                   2000 |                  100 |                   2000 |                 -100 |    0
(4 rows)

UPDATE result1 SET source = 1000 WHERE source = 1;
UPDATE 1
UPDATE result1 SET target = 1000 WHERE target = 1;
UPDATE 1
UPDATE result1 SET source = 2000 WHERE source = 3;
UPDATE 1
UPDATE result1 SET target = 2000 WHERE target = 3;
UPDATE 1
SELECT seq, edge, source, target, cost
INTO result2
FROM result1
ORDER BY seq;
SELECT 4
SELECT * from pgr_dijkstra($$SELECT id, * FROM edge_table$$,
    1000, 2000);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 | 1000 |  100 |    1 |        0
   2 |        2 | 2000 |   -1 |    0 |        1
(2 rows)

SELECT * from pgr_dijkstra($$SELECT seq AS id, * FROM result2$$,
    1000, 2000);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 | 1000 |    1 |    1 |        0
   2 |        2 |    4 |    4 |    0 |        1
   3 |        3 | 2000 |   -1 |    0 |        1
(3 rows)

SELECT * from pgr_dijkstra($$SELECT seq AS id, * FROM result2$$,
    1000, 2000) WHERE cost != 0 OR edge = -1 ORDER BY seq;
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 | 1000 |    1 |    1 |        0
   3 |        3 | 2000 |   -1 |    0 |        1
(2 rows)

SELECT * from pgr_dijkstra($$SELECT seq AS id, * FROM result2$$,
    1000, 2000) WHERE cost != 0 OR edge = -1 ORDER BY seq;
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 | 1000 |    1 |    1 |        0
   3 |        3 | 2000 |   -1 |    0 |        1
(2 rows)

ROLLBACK;
ROLLBACK
