BEGIN;
BEGIN
SET client_min_messages TO NOTICE;
SET
--q1
SELECT * FROM _pgr_pickDeliver(
    'SELECT * FROM orders ORDER BY id',
    'SELECT * from vehicles',
    
    'WITH
    A AS (
        SELECT p_node_id AS id, p_x AS x, p_y AS y FROM orders
        UNION
        SELECT d_node_id AS id, d_x, d_y FROM orders
        UNION
        SELECT start_node_id, start_x, start_y FROM vehicles
    )
    SELECT A.id AS start_vid, B.id AS end_vid, sqrt( (a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y)) AS agg_cost
    FROM A, A AS B WHERE A.id != B.id'
    );
 seq | vehicle_seq | vehicle_id | stop_seq | stop_type | stop_id |      order_id       |      cargo       |   travel_time    | arrival_time |    wait_time     |   service_time   | departure_time 
-----+-------------+------------+----------+-----------+---------+---------------------+------------------+------------------+--------------+------------------+------------------+----------------
   1 |           1 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
   2 |           1 |          1 |        2 |        22 |       5 | 4621819117588971520 | 15.1327459504216 | 15.1327459504216 |            0 |               90 | 105.132745950422 |               
   3 |           1 |          1 |        3 |         6 |       3 | 4626322717216342016 |                1 | 106.132745950422 |            0 |               90 | 196.132745950422 |               
   4 |           1 |          1 |        4 |        93 |       5 | 4621819117588971520 |                2 | 198.132745950422 |            0 |               90 | 288.132745950422 |               
   5 |           1 |          1 |        5 |        65 |       8 | 4629137466983448576 | 2.82842712474619 | 290.961173075168 |            0 |               90 | 380.961173075168 |               
   6 |           1 |          1 |        6 |        45 |       8 | 4621819117588971520 | 3.60555127546399 | 384.566724350632 |            0 |               90 | 474.566724350632 |               
   7 |           1 |          1 |        7 |        99 |      11 | 4626322717216342016 |                3 | 477.566724350632 |            0 |               90 | 567.566724350632 |               
   8 |           1 |          1 |        8 |        20 |       9 | 4629137466983448576 | 3.16227766016838 |   570.7290020108 |            0 |               90 |   660.7290020108 |               
   9 |           1 |          1 |        9 |        51 |       6 | 4632233691727265792 | 2.23606797749979 |   662.9650699883 |            0 |               90 |   752.9650699883 |               
  10 |           1 |          1 |       10 |        42 |       9 | 4630826316843712512 | 2.23606797749979 |   755.2011379658 |            0 |               90 |   845.2011379658 |               
  11 |           1 |          1 |       11 |        48 |       6 | 4626322717216342016 | 3.60555127546399 | 848.806689241264 |            0 |               90 | 938.806689241264 |               
  12 |           1 |          1 |       12 |        97 |      11 | 4621819117588971520 |                2 | 940.806689241264 |            0 |               90 | 1030.80668924126 |               
  13 |           1 |          1 |       13 |        66 |       3 |                   0 |                3 | 1033.80668924126 |            0 |               90 | 1123.80668924126 |               
  14 |           1 |          1 |       14 |       101 |      -1 |                   0 | 15.8113883008419 | 1139.61807754211 |            0 |                0 | 1139.61807754211 |               
  15 |           2 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
  16 |           2 |          1 |        2 |        47 |      13 | 4629137466983448576 | 30.8058436014987 | 30.8058436014987 |            0 |               90 | 120.805843601499 |               
  17 |           2 |          1 |        3 |        63 |      13 |                   0 |                4 | 124.805843601499 |            0 |               90 | 214.805843601499 |               
  18 |           2 |          1 |        4 |        17 |      18 | 4626322717216342016 |                3 | 217.805843601499 |            0 |               90 | 307.805843601499 |               
  19 |           2 |          1 |        5 |        64 |      19 | 4629137466983448576 |                5 | 312.805843601499 |            0 |               90 | 402.805843601499 |               
  20 |           2 |          1 |        6 |         1 |      19 | 4626322717216342016 |                5 | 407.805843601499 |            0 |               90 | 497.805843601499 |               
  21 |           2 |          1 |        7 |        60 |      16 | 4633641066610819072 |                5 | 502.805843601499 |            0 |               90 | 592.805843601499 |               
  22 |           2 |          1 |        8 |        50 |      16 | 4626322717216342016 |                2 | 594.805843601499 |            0 |               90 | 684.805843601499 |               
  23 |           2 |          1 |        9 |        59 |      18 |                   0 |                3 | 687.805843601499 |            0 |               90 | 777.805843601499 |               
  24 |           2 |          1 |       10 |        83 |      50 | 4621819117588971520 | 53.0094331227943 | 830.815276724293 |            0 |               90 | 920.815276724293 |               
  25 |           2 |          1 |       11 |        31 |      50 |                   0 | 3.16227766016838 | 923.977554384461 |            0 |               90 | 1013.97755438446 |               
  26 |           2 |          1 |       12 |        61 |      49 | 4621819117588971520 |                3 | 1016.97755438446 |            0 |               90 | 1106.97755438446 |               
  27 |           2 |          1 |       13 |        52 |      49 |                   0 |                2 | 1108.97755438446 |            0 |               90 | 1198.97755438446 |               
  28 |           2 |          1 |       14 |       101 |      -1 |                   0 | 18.0277563773199 | 1217.00531076178 |            0 |                0 | 1217.00531076178 |               
  29 |           3 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
  30 |           3 |          1 |        2 |        14 |      20 | 4621819117588971520 |               10 |               10 |            0 |               90 |              100 |               
  31 |           3 |          1 |        3 |        16 |      20 |                   0 |                5 |              105 |            0 |               90 |              195 |               
  32 |           3 |          1 |        4 |        56 |      25 | 4630826316843712512 |                2 |              197 |            0 |               90 |              287 |               
  33 |           3 |          1 |        5 |        40 |      25 |                   0 |                2 |              289 |            0 |               90 |              379 |               
  34 |           3 |          1 |        6 |        28 |      29 | 4621819117588971520 | 3.60555127546399 | 382.605551275464 |            0 |               90 | 472.605551275464 |               
  35 |           3 |          1 |        7 |        12 |      30 | 4626322717216342016 |                5 | 477.605551275464 |            0 |               90 | 567.605551275464 |               
  36 |           3 |          1 |        8 |        15 |      28 | 4630826316843712512 |                3 | 570.605551275464 |            0 |               90 | 660.605551275464 |               
  37 |           3 |          1 |        9 |         3 |      29 | 4629137466983448576 |                2 | 662.605551275464 |            0 |               90 | 752.605551275464 |               
  38 |           3 |          1 |       10 |        87 |      23 | 4630826316843712512 |                3 | 755.605551275464 |            0 |                0 | 755.605551275464 |               
  39 |           3 |          1 |       11 |        87 |      23 | 4629137466983448576 |                0 | 755.605551275464 |            0 |               90 | 845.605551275464 |               
  40 |           3 |          1 |       12 |        69 |      28 | 4621819117588971520 |                3 | 848.605551275464 |            0 |               90 | 938.605551275464 |               
  41 |           3 |          1 |       13 |        30 |      30 |                   0 |                2 | 940.605551275464 |            0 |               90 | 1030.60555127546 |               
  42 |           3 |          1 |       14 |       101 |      -1 |                   0 | 10.1980390271856 | 1040.80359030265 |            0 |                0 | 1040.80359030265 |               
  43 |           4 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
  44 |           4 |          1 |        2 |        74 |      32 | 4629137466983448576 | 31.6227766016838 | 31.6227766016838 |            0 |               90 | 121.622776601684 |               
  45 |           4 |          1 |        3 |        76 |      33 | 4634626229029306368 |                2 | 123.622776601684 |            0 |               90 | 213.622776601684 |               
  46 |           4 |          1 |        4 |        96 |      32 | 4630826316843712512 |  5.3851648071345 | 219.007941408818 |            0 |               90 | 309.007941408818 |               
  47 |           4 |          1 |        5 |        26 |      35 | 4632233691727265792 |                5 | 314.007941408818 |            0 |               90 | 404.007941408818 |               
  48 |           4 |          1 |        6 |        13 |      33 | 4621819117588971520 |  5.8309518948453 | 409.838893303664 |            0 |               90 | 499.838893303664 |               
  49 |           4 |          1 |        7 |        36 |      38 | 4630826316843712512 |                2 | 501.838893303664 |            0 |               90 | 591.838893303664 |               
  50 |           4 |          1 |        8 |        94 |      35 | 4629137466983448576 |                5 | 596.838893303664 |            0 |               90 | 686.838893303664 |               
  51 |           4 |          1 |        9 |        84 |      36 | 4630826316843712512 |                5 | 691.838893303664 |            0 |                0 | 691.838893303664 |               
  52 |           4 |          1 |       10 |        84 |      36 | 4629137466983448576 |                0 | 691.838893303664 |            0 |               90 | 781.838893303664 |               
  53 |           4 |          1 |       11 |         2 |      38 |                   0 |                3 | 784.838893303664 |            0 |               90 | 874.838893303664 |               
  54 |           4 |          1 |       12 |       101 |      -1 |                   0 | 32.3882694814033 | 907.227162785067 |            0 |                0 | 907.227162785067 |               
  55 |           5 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
  56 |           5 |          1 |        2 |        55 |      43 | 4621819117588971520 | 16.5529453572468 | 16.5529453572468 |            0 |               90 | 106.552945357247 |               
  57 |           5 |          1 |        3 |        57 |      42 | 4629137466983448576 |                3 | 109.552945357247 |            0 |               90 | 199.552945357247 |               
  58 |           5 |          1 |        4 |        24 |      43 | 4626322717216342016 |                2 | 201.552945357247 |            0 |               90 | 291.552945357247 |               
  59 |           5 |          1 |        5 |         7 |      42 |                   0 |                2 | 293.552945357247 |            0 |               90 | 383.552945357247 |               
  60 |           5 |          1 |        6 |         9 |      44 | 4621819117588971520 |                3 | 386.552945357247 |            0 |               90 | 476.552945357247 |               
  61 |           5 |          1 |        7 |        49 |      44 |                   0 | 2.82842712474619 | 479.381372481993 |            0 |               90 | 569.381372481993 |               
  62 |           5 |          1 |        8 |        33 |      45 | 4621819117588971520 |                2 | 571.381372481993 |            0 |               90 | 661.381372481993 |               
  63 |           5 |          1 |        9 |        75 |      45 |                   0 |                2 | 663.381372481993 |            0 |               90 | 753.381372481993 |               
  64 |           5 |          1 |       10 |        44 |      51 | 4621819117588971520 |                3 | 756.381372481993 |            0 |                0 | 756.381372481993 |               
  65 |           5 |          1 |       11 |        44 |      51 |                   0 |                0 | 756.381372481993 |            0 |               90 | 846.381372481993 |               
  66 |           5 |          1 |       12 |        34 |      66 | 4621819117588971520 |  22.561028345357 |  868.94240082735 |            0 |               90 |  958.94240082735 |               
  67 |           5 |          1 |       13 |        79 |      66 |                   0 |                2 |  960.94240082735 |            0 |               90 | 1050.94240082735 |               
  68 |           5 |          1 |       14 |       101 |      -1 |                   0 | 15.8113883008419 | 1066.75378912819 |            0 |                0 | 1066.75378912819 |               
  69 |           6 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
  70 |           6 |          1 |        2 |        89 |      57 | 4630826316843712512 |               35 |               35 |            0 |               90 |              125 |               
  71 |           6 |          1 |        3 |        25 |      57 |                   0 |                2 |              127 |            0 |               90 |              217 |               
  72 |           6 |          1 |        4 |        71 |      54 | 4630826316843712512 |                5 |              222 |            0 |               90 |              312 |               
  73 |           6 |          1 |        5 |        90 |      53 | 4633641066610819072 |  5.3851648071345 | 317.385164807135 |            0 |               90 | 407.385164807135 |               
  74 |           6 |          1 |        6 |        77 |      56 | 4636033603912859648 |                4 | 411.385164807135 |            0 |               90 | 501.385164807135 |               
  75 |           6 |          1 |        7 |        62 |      53 | 4634626229029306368 |                2 | 503.385164807135 |            0 |               90 | 593.385164807135 |               
  76 |           6 |          1 |        8 |        23 |      54 | 4629137466983448576 |                3 | 596.385164807135 |            0 |               90 | 686.385164807135 |               
  77 |           6 |          1 |        9 |        98 |      56 |                   0 | 10.4403065089106 | 696.825471316045 |            0 |               90 | 786.825471316045 |               
  78 |           6 |          1 |       10 |       101 |      -1 |                   0 | 35.0570962859162 | 821.882567601961 |            0 |                0 | 821.882567601961 |               
  79 |           7 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
  80 |           7 |          1 |        2 |         8 |      67 | 4621819117588971520 | 12.2065556157337 | 12.2065556157337 |            0 |               90 | 102.206555615734 |               
  81 |           7 |          1 |        3 |        35 |      65 | 4626322717216342016 |                1 | 103.206555615734 |            0 |               90 | 193.206555615734 |               
  82 |           7 |          1 |        4 |        68 |      63 | 4634626229029306368 |                2 | 195.206555615734 |            0 |               90 | 285.206555615734 |               
  83 |           7 |          1 |        5 |        95 |      62 | 4636033603912859648 |                5 | 290.206555615734 |            0 |               90 | 380.206555615734 |               
  84 |           7 |          1 |        6 |         5 |      63 | 4630826316843712512 |                3 | 383.206555615734 |            0 |               90 | 473.206555615734 |               
  85 |           7 |          1 |        7 |        18 |      65 | 4629137466983448576 |                5 | 478.206555615734 |            0 |               90 | 568.206555615734 |               
  86 |           7 |          1 |        8 |        81 |      67 | 4626322717216342016 |                3 | 571.206555615734 |            0 |               90 | 661.206555615734 |               
  87 |           7 |          1 |        9 |        21 |      64 | 4629137466983448576 |                2 | 663.206555615734 |            0 |                0 | 663.206555615734 |               
  88 |           7 |          1 |       10 |        21 |      64 | 4626322717216342016 |                0 | 663.206555615734 |            0 |               90 | 753.206555615734 |               
  89 |           7 |          1 |       11 |        91 |      62 |                   0 |                3 | 756.206555615734 |            0 |               90 | 846.206555615734 |               
  90 |           7 |          1 |       12 |       101 |      -1 |                   0 | 20.6155281280883 | 866.822083743822 |            0 |                0 | 866.822083743822 |               
  91 |           8 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
  92 |           8 |          1 |        2 |        70 |      81 | 4629137466983448576 | 47.4341649025257 | 47.4341649025257 |            0 |               90 | 137.434164902526 |               
  93 |           8 |          1 |        3 |        37 |      78 | 4632233691727265792 |                3 | 140.434164902526 |            0 |                0 | 140.434164902526 |               
  94 |           8 |          1 |        4 |        37 |      78 | 4629137466983448576 |                0 | 140.434164902526 |            0 |               90 | 230.434164902526 |               
  95 |           8 |          1 |        5 |        92 |      76 | 4630826316843712512 |                2 | 232.434164902526 |            0 |               90 | 322.434164902526 |               
  96 |           8 |          1 |        6 |        39 |      71 | 4633641066610819072 |                5 | 327.434164902526 |            0 |               90 | 417.434164902526 |               
  97 |           8 |          1 |        7 |        54 |      81 | 4629137466983448576 |                5 | 422.434164902526 |            0 |               90 | 512.434164902526 |               
  98 |           8 |          1 |        8 |        41 |      76 | 4626322717216342016 |                3 | 515.434164902526 |            0 |               90 | 605.434164902526 |               
  99 |           8 |          1 |        9 |        53 |      71 |                   0 |                4 | 609.434164902526 |            0 |               90 | 699.434164902526 |               
 100 |           8 |          1 |       10 |        32 |      79 | 4621819117588971520 |                1 | 700.434164902526 |            0 |               90 | 790.434164902526 |               
 101 |           8 |          1 |       11 |         4 |      79 |                   0 |  5.3851648071345 |  795.81932970966 |            0 |               90 |  885.81932970966 |               
 102 |           8 |          1 |       12 |       101 |      -1 |                   0 |  51.478150704935 | 937.297480414595 |            0 |                0 | 937.297480414595 |               
 103 |           9 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
 104 |           9 |          1 |        2 |        38 |      90 | 4621819117588971520 | 20.6155281280883 | 20.6155281280883 |            0 |               90 | 110.615528128088 |               
 105 |           9 |          1 |        3 |        72 |      87 | 4629137466983448576 |                5 | 115.615528128088 |            0 |               90 | 205.615528128088 |               
 106 |           9 |          1 |        4 |        82 |      86 | 4630826316843712512 |                1 | 206.615528128088 |            0 |               90 | 296.615528128088 |               
 107 |           9 |          1 |        5 |        19 |      87 | 4626322717216342016 |                6 | 302.615528128088 |            0 |               90 | 392.615528128088 |               
 108 |           9 |          1 |        6 |        80 |      82 | 4630826316843712512 |                3 | 395.615528128088 |            0 |               90 | 485.615528128088 |               
 109 |           9 |          1 |        7 |        67 |      84 | 4633641066610819072 |  5.8309518948453 | 491.446480022934 |            0 |               90 | 581.446480022934 |               
 110 |           9 |          1 |        8 |        88 |      82 | 4630826316843712512 | 2.82842712474619 |  584.27490714768 |            0 |               90 |  674.27490714768 |               
 111 |           9 |          1 |        9 |        43 |      90 | 4629137466983448576 |                3 |  677.27490714768 |            0 |               90 |  767.27490714768 |               
 112 |           9 |          1 |       10 |        78 |      84 | 4621819117588971520 | 2.82842712474619 | 770.103334272426 |            0 |               90 | 860.103334272426 |               
 113 |           9 |          1 |       11 |        58 |      86 |                   0 | 3.60555127546399 |  863.70888554789 |            0 |               90 |  953.70888554789 |               
 114 |           9 |          1 |       12 |       101 |      -1 |                   0 | 22.3606797749979 | 976.069565322888 |            0 |                0 | 976.069565322888 |               
 115 |          10 |          1 |        1 |       101 |      -1 |                   0 |                0 |                0 |            0 |                0 |                0 |               
 116 |          10 |          1 |        2 |        10 |      98 | 4626322717216342016 | 30.8058436014987 | 30.8058436014987 |            0 |               90 | 120.805843601499 |               
 117 |          10 |          1 |        3 |        29 |      96 | 4629137466983448576 |  5.3851648071345 | 126.191008408633 |            0 |               90 | 216.191008408633 |               
 118 |          10 |          1 |        4 |        11 |      98 | 4621819117588971520 |                2 | 218.191008408633 |            0 |               90 | 308.191008408633 |               
 119 |          10 |          1 |        5 |        85 |      96 |                   0 | 3.60555127546399 | 311.796559684097 |            0 |               90 | 401.796559684097 |               
 120 |          10 |          1 |        6 |        73 |      92 | 4626322717216342016 | 3.60555127546399 | 405.402110959561 |            0 |               90 | 495.402110959561 |               
 121 |          10 |          1 |        7 |        27 |      92 |                   0 |                2 | 497.402110959561 |            0 |               90 | 587.402110959561 |               
 122 |          10 |          1 |        8 |        86 |      97 | 4629137466983448576 |                5 | 592.402110959561 |            0 |                0 | 592.402110959561 |               
 123 |          10 |          1 |        9 |        86 |      97 |                   0 |                0 | 592.402110959561 |            0 |               90 | 682.402110959561 |               
 124 |          10 |          1 |       10 |        46 |     100 | 4626322717216342016 |                5 | 687.402110959561 |            0 |               90 | 777.402110959561 |               
 125 |          10 |          1 |       11 |       100 |     100 |                   0 |                5 | 782.402110959561 |            0 |               90 | 872.402110959561 |               
 126 |          10 |          1 |       12 |       101 |      -1 |                   0 | 33.5410196624968 | 905.943130622058 |            0 |                0 | 905.943130622058 |               
 127 |          -2 |          0 |        0 |        -1 |      -1 | 4650946700206176264 |               -1 |                0 |         9000 | 9879.42275822512 |                0 |               
(127 rows)

--q2
ROLLBACK;
ROLLBACK
