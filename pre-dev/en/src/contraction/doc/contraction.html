<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Contraction &mdash; pgRouting Manual (2.3.0-dev) (test/appveyor)</title>
    
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.3.0 (test/appveyor)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="pgRouting Manual (2.3.0-dev) (test/appveyor)" href="../../../index.html" />
    <link rel="up" title="Experimental and Proposed functions" href="../../proposed.html" />
    <link rel="next" title="pgr_contractGraph - Proposed" href="pgr_contractGraph.html" />
    <link rel="prev" title="Experimental and Proposed functions" href="../../proposed.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="../../../_static/pgrouting.png" alt="Logo"/><h1 class="heading"><a href="../../../index.html">
          <span>pgRouting Manual (2.3.0-dev) (test/appveyor)</span></a></h1>
        <h2 class="heading"><span>Contraction</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="../../proposed.html">Experimental and Proposed functions</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../doc/index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="pgr_contractGraph.html">pgr_contractGraph - Proposed</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="contraction">
<span id="id1"></span><h1>Contraction<a class="headerlink" href="#contraction" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>These are proposed functions</p>
<ul class="last simple">
<li>They are not officially of the current release.</li>
<li>They likely will not be officialy be part of the next release:<ul>
<li>The functions might not make use of ANY-INTEGER and ANY-NUMERICAL</li>
<li>Name might change.</li>
<li>Signature might change.</li>
<li>Functionality might change.</li>
<li>pgTap tests might be missing.</li>
<li>Might need c/c++ coding.</li>
<li>May lack documentation.</li>
<li>Documentation if any might need to be rewritten.</li>
<li>Documentation examples might need to be automatically generated.</li>
<li>Might need a lot of feedback from the comunity.</li>
<li>Might depend on a proposed function of pgRouting</li>
<li>Might depend on a deprecated function of pgRouting</li>
</ul>
</li>
</ul>
</div>
<p><a class="reference internal" href="pgr_contractGraph.html#pgr-contractgraph"><em>pgr_contractGraph - Proposed</em></a></p>
<p>Contracting a graph becomes a crucial operation when talking about big graphs like
the graphs involved in routing across cities, countries, continents or the whole world.</p>
<p>The contraction level and contraction operations can become very complex, as the complexity
of the graphs grows.</p>
<p>For this proposal, we are making our contraction algorithm simple as possible so that
more contraction operations can be added in the future.</p>
<p>We are not aiming with this work to implement all the possible contraction operations
but to give a framework such that adding a contraction operation can be easily achieved.</p>
<p>For this contraction proposal I am only making 2 operations:</p>
<blockquote>
<div><ol class="arabic simple">
<li>dead end contraction: vertices have one incoming edge</li>
<li>linear contraction: vertices have one incomming and one outgoing edge</li>
</ol>
</div></blockquote>
<p>And with the additional characteristics:</p>
<blockquote>
<div><ul class="simple">
<li>The user can forbid to contract a particular set of nodes or edges.</li>
<li>The user can decide how many times the cycle can be done.</li>
<li>If possible, the user can decide the order of the operations on a cycle.</li>
</ul>
</div></blockquote>
<div class="section" id="the-contraction-skeleton">
<h2>The contraction skeleton<a class="headerlink" href="#the-contraction-skeleton" title="Permalink to this headline">¶</a></h2>
<p>In general we have an initial set up that may involve analizing the graph given as input and setting the
non contractable nodes or edges. We have a cycle that will go and perform a contraction operation
until while possible, and then move to the next contraction operation.
Adding a new operation then becomes an &#8220;easy&#8221; task; more things might be involved, because the
charachteristics of the graph change each time its contracted, so some interaction between contractions
has to be implemented also.</p>
</div>
<div class="section" id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>For contracting, we are going to cycle as follows</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre>input: G(V,E);
removed_vertices = {};


&lt;initial set up&gt;
do N times {

    while ( &lt;conditions for 1&gt; ) {
        &lt; contraction operation 1 &gt;
    }

    while ( &lt;conditions for 2&gt; ) {
        &lt; contraction operation 2&gt;
    }
    .....
}

output: G&#39;(V&#39;,E&#39;), removed_vertices
</pre></div>
</div>
</div>
<div class="section" id="contraction-operations-for-this-implementation">
<h2>Contraction operations for this implementation<a class="headerlink" href="#contraction-operations-for-this-implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dead-end-contraction">
<h3>Dead end contraction<a class="headerlink" href="#dead-end-contraction" title="Permalink to this headline">¶</a></h3>
<p>Characteristics:</p>
<blockquote>
<div><ul class="simple">
<li><span class="math">\(V1\)</span>: set of vertices with 1 incoming edge in increasing order of id:<ul>
<li>Edges with the same identifier are considered the same edge
and if it has the <cite>reverse_cost</cite> valid the outgoing edge is ignored</li>
</ul>
</li>
</ul>
</div></blockquote>
<div class="highlight-none"><div class="highlight"><pre>while ( V1 is not empty ) {

    delete vertex of V1
    the deleted vertex add it to removed_vertices
    vertex that leads to removed vertex, inherits the removed vertex

    &lt;adjust any conditions that might affect other contraction operation&gt;
}
</pre></div>
</div>
</div>
<div class="section" id="linear-contraction">
<h3>Linear contraction<a class="headerlink" href="#linear-contraction" title="Permalink to this headline">¶</a></h3>
<p>Characteristics:</p>
<blockquote>
<div><ul class="simple">
<li><span class="math">\(V2\)</span>: vertex with 1 incoming edge and 1 outgoing edge:<ul>
<li>The outgoing edge must have different identifier of the incomming edge</li>
</ul>
</li>
</ul>
</div></blockquote>
<div class="highlight-none"><div class="highlight"><pre>while ( V2 is not empty ) {

    delete vertex of V2
    create edge (shortcut)
    the deleted vertex add it to removed_vertices
    inewly created edge, inherits the removed vertex

    &lt;adjust any conditions that might affect other contraction operations&gt;
}
</pre></div>
</div>
</div>
<div class="section" id="notation">
<h3>Notation<a class="headerlink" href="#notation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>V: is the set of vertices</li>
<li>E: is the set of edges</li>
<li>G: is the graph</li>
<li><span class="math">\(V1\)</span>: is the set of <em>dead end</em> vertices</li>
<li><span class="math">\(V2\)</span>: is the set of <em>linear</em> vertices</li>
<li>removed_vertices: is the set of removed vertices</li>
</ul>
<p>The contracted graph will be represented with two parameters, the modified Graph, and the removed_vertices set.</p>
<p>removed_vertices = {(v,1):{2}, (e,-1):{3}}.</p>
<dl class="docutils">
<dt>The above notation indicates:</dt>
<dd><ul class="first last simple">
<li>Vertex 2 is removed, and belongs to vertex 1 subgraph</li>
<li>Vertex 3 is removed, and belongs to edge -1 subgraph</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>For simplicity all the edges in the examples have unit weight.</p>
<div class="section" id="dead-end">
<h3>Dead End<a class="headerlink" href="#dead-end" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Perform dead end contraction operation first and then linear contraction</li>
<li>1 cycle of contraction.</li>
</ul>
<img alt="../../../_images/twoNodesoneEdge_a.png" src="../../../_images/twoNodesoneEdge_a.png" />
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Input:</th><td class="field-body">G = {V:{1, 2}, E:{(1, 2)}}</td>
</tr>
<tr class="field-even field"><th class="field-name">initial set up:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>removed_vertices={}
V1 = {2}
V2 = {}
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">procedure:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>V1 = {2} is not empty

    V1 = {}
    V2 = {}
    G = {V:{1}, E:{}}
    removed_vertices = {(v, 1):{2}}.

V1 is empty
</pre></div>
</div>
<p>Since V1 is empty we go on to the next contraction operation</p>
<div class="highlight-none"><div class="highlight"><pre>V2 is empty
</pre></div>
</div>
<p>So we do not perform any linear contraction operation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Results:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>G = {V:{1}, E:{}}
removed_vertices = {(v, 1):{2}}
</pre></div>
</div>
<p>Visualy the results are</p>
<img alt="../../../_images/twoNodesoneEdge_b.png" src="../../../_images/twoNodesoneEdge_b.png" />
</div>
<div class="section" id="id2">
<h3>Linear contraction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Perform linear contraction operation first and then dead end contraction</li>
<li>1 cycle of contraction.</li>
</ul>
<img alt="../../../_images/threeNodestwoEdges_a.png" src="../../../_images/threeNodestwoEdges_a.png" />
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Input:</th><td class="field-body">G = {V:{1, 2, 3}, E:{(1, 2), (2, 3)}}</td>
</tr>
<tr class="field-even field"><th class="field-name">initial set up:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>removed_vertices={}
V1 = {3}
V2 = {2}
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">procedure:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>V2 = {2} is not empty

    V1 = {3}
    removed_vertices = {(e, -1):{2}}
    V2 = {}
    G = {V:{1, 3}, E:{-1(1,3,c=2)}}

V2 is empty
</pre></div>
</div>
<img alt="../../../_images/threeNodestwoEdges_b.png" src="../../../_images/threeNodestwoEdges_b.png" />
<p>Since V2 is empty we go on to the next contraction operation</p>
<div class="highlight-none"><div class="highlight"><pre>V1 = {3} is not empty

    V1 = {}
    V2 = {}
    removed_vertices = {(v, 1):{3, 2}}.
    G = {V:{1}, E:{}}

V1 is empty
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Results:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>removed_vertices = {(v, 1):{3, 2}}.
G = {V:{1}, E:{}}
</pre></div>
</div>
<p>Visualy the results are</p>
<img alt="../../../_images/threeNodestwoEdges_c.png" src="../../../_images/threeNodestwoEdges_c.png" />
</div>
<div class="section" id="sample-data">
<h3>Sample Data<a class="headerlink" href="#sample-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Perform dead end contraction operation first and then linear contraction</li>
<li>1 cycle of contraction.</li>
</ul>
<img alt="../../../_images/undirected_sampledata_a.png" src="../../../_images/undirected_sampledata_a.png" />
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Input:</th><td class="field-body">G = {V:{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17},
E:{1(1, 2), 2(2,3), 3(3,4), 4(2,5), 5(3,6), 6(7,8), 7(8,5), 8(5,6),
9(6,9), 10(5,10), 11(6,11), 12(10,11), 13(11,12), 14(10,13), 15(9,12),
16(4,9), 17(14,15), 18(16,17)}}</td>
</tr>
<tr class="field-even field"><th class="field-name">initial set up:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>removed_vertices={}
V1 = {1,7,13,14,15,16,17}
V2 = {4,8,12}
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">procedure:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>V1 = {1,7,13,14,15,16,17} is not empty

    V1 = {7,13,14,15,16,17}
    V2 = {2,4,8,12}
    G = {V:{2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17},
    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 6(7,8), 7(8,5), 8(5,6), 9(6,9),
        10(5,10), 11(6,11), 12(10,11), 13(11,12), 14(10,13), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}
    removed_vertices = {(v, 2):{1}}.


V1 = {7,13,14,15,16,17} is not empty

    V1 = {8,13,14,15,16,17}
    V2 = {2,4,12}
    G = {V:{2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17},
    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 7(8,5), 8(5,6), 9(6,9), 10(5,10),
        11(6,11), 12(10,11), 13(11,12), 14(10,13), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}
    removed_vertices = {(v, 2):{1}, (v,8):{7}}.

V1 = {8,13,14,15,16,17} is not empty

    V1 = {13,14,15,16,17}
    V2 = {2,4,12}
    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 13, 14, 15, 16, 17},
    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),
         11(6,11), 12(10,11), 13(11,12), 14(10,13), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}
    removed_vertices = {(v, 2):{1}, (v,5):{8,7}}.

V1 = {13,14,15,16,17} is not empty

    V1 = {14,15,16,17}
    V2 = {2,4,10,12}
    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 14, 15, 16, 17},
    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),
         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9), 17(14,15), 18(16,17)}}
    removed_vertices = {(v, 2):{1}, (v,5):{8,7}, (v,10):{13}}.

V1 = {14,15,16,17} is not empty

    V1 = {16,17}
    V2 = {2,4,10,12}
    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 15, 16, 17},
    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),
         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9)}, 18(16,17)}
    removed_vertices = {(v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}}.

V1 = {16,17} is not empty

    V1 = {}
    V2 = {2,4,10,12}
    G = {V:{2, 3, 4, 5, 6, 9, 10, 11, 12, 15, 17},
    E:{2(2,3), 3(3,4), 4(2,5), 5(3,6), 8(5,6), 9(6,9), 10(5,10),
         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9)}}
    removed_vertices = {(v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}, (v,17):{16}}.

Since V1 is empty we go on to the next contraction operation
</pre></div>
</div>
<img alt="../../../_images/undirected_sampledata_b.png" src="../../../_images/undirected_sampledata_b.png" />
<div class="highlight-none"><div class="highlight"><pre>V2 = {2,4,10,12} is not empty

    V1 = {}
    V2 = {4,10,12}
    G = {V:{3, 4, 5, 6, 9, 10, 11, 12, 15, 17},
    E:{-1(3,5), 3(3,4), 5(3,6), 8(5,6), 9(6,9), 10(5,10),
         11(6,11), 12(10,11), 13(11,12), 15(9,12), 16(4,9)}}
    removed_vertices = {(e, -1):{1,2}, (v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}, (v,17):{16}}.

V2 = {4,10,12} is not empty

    V1 = {}
    V2 = {10,12}
    G = {V:{3, 5, 6, 9, 10, 11, 12, 15, 17},
    E:{-1(3,5),-2(3,9), 5(3,6), 8(5,6), 9(6,9), 10(5,10),
         11(6,11), 12(10,11), 13(11,12), 15(9,12)}}
    removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (v, 2):{1}, (v,5):{8,7}, (v,10):{13}, (v,15):{14}, (v,17):{16}}.

V2 = {10,12} is not empty

    V1 = {}
    V2 = {12}
    G = {V:{3, 5, 6, 9, 11, 12, 15, 17},
    E:{-1(3,5),-2(3,9), -3(5,11), 5(3,6), 8(5,6), 9(6,9),
         11(6,11), 13(11,12), 15(9,12)}}
    removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (e,-3):{10,13}, (v, 2):{1}, (v,5):{8,7}, (v,15):{14}, (v,17):{16}}.

V2 = {12} is not empty

    V1 = {}
    V2 = {}
    G = {V:{3, 5, 6, 9, 11, 15, 17},
    E:{-1(3,5),-2(3,9), -3(5,11), -4(9,11), 5(3,6), 8(5,6), 9(6,9), 11(6,11)}}
    removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (e,-3):{10,13}, (e, -4):{12},
         (v, 2):{1}, (v,5):{8,7}, (v,15):{14}, (v,17):{16}}.
</pre></div>
</div>
<p>Since V1 and V2 are empty we stop our contraction here.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Results:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre>G = {V:{3, 5, 6, 9, 11, 15, 17},
E:{-1(3,5),-2(3,9), -3(5,11), -4(9,11), 5(3,6), 8(5,6), 9(6,9), 11(6,11)}}
removed_vertices = {(e, -1):{1,2}, (e, -2):{4}, (e,-3):{10,13}, (e, -4):{12},
     (v, 2):{1}, (v,5):{8,7}, (v,15):{14}, (v,17):{16}}.
</pre></div>
</div>
<p>Visually the results are</p>
<img alt="../../../_images/undirected_sampledata_c.png" src="../../../_images/undirected_sampledata_c.png" />
</div>
<div class="section" id="detailed-procedure">
<h3>Detailed Procedure<a class="headerlink" href="#detailed-procedure" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Original Data:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre>SELECT id, source, target, cost, reverse_cost FROM edge_table;
 id | source | target | cost | reverse_cost 
----+--------+--------+------+--------------
  1 |      1 |      2 |    1 |            1
  2 |      2 |      3 |   -1 |            1
  3 |      3 |      4 |   -1 |            1
  4 |      2 |      5 |    1 |            1
  5 |      3 |      6 |    1 |           -1
  6 |      7 |      8 |    1 |            1
  7 |      8 |      5 |    1 |            1
  8 |      5 |      6 |    1 |            1
  9 |      6 |      9 |    1 |            1
 10 |      5 |     10 |    1 |            1
 11 |      6 |     11 |    1 |           -1
 12 |     10 |     11 |    1 |           -1
 13 |     11 |     12 |    1 |           -1
 14 |     10 |     13 |    1 |            1
 15 |      9 |     12 |    1 |            1
 16 |      4 |      9 |    1 |            1
 17 |     14 |     15 |    1 |            1
 18 |     16 |     17 |    1 |            1
(18 rows)
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Addition of new columns:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">edge_table</span> <span class="k">ADD</span> <span class="n">is_contracted</span> <span class="nb">BOOLEAN</span> <span class="k">DEFAULT</span> <span class="k">false</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">edge_table</span> <span class="k">ADD</span> <span class="n">contracted_vertices</span> <span class="nb">BIGINT</span><span class="p">[];</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Data After Adding Columns:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre>SELECT id, source, target, cost, reverse_cost, is_contracted,
contracted_vertices FROM edge_table;
 id | source | target | cost | reverse_cost | is_contracted | contracted_vertices 
----+--------+--------+------+--------------+---------------+---------------------
  1 |      1 |      2 |    1 |            1 | f             | 
  2 |      2 |      3 |   -1 |            1 | f             | 
  3 |      3 |      4 |   -1 |            1 | f             | 
  4 |      2 |      5 |    1 |            1 | f             | 
  5 |      3 |      6 |    1 |           -1 | f             | 
  6 |      7 |      8 |    1 |            1 | f             | 
  7 |      8 |      5 |    1 |            1 | f             | 
  8 |      5 |      6 |    1 |            1 | f             | 
  9 |      6 |      9 |    1 |            1 | f             | 
 10 |      5 |     10 |    1 |            1 | f             | 
 11 |      6 |     11 |    1 |           -1 | f             | 
 12 |     10 |     11 |    1 |           -1 | f             | 
 13 |     11 |     12 |    1 |           -1 | f             | 
 14 |     10 |     13 |    1 |            1 | f             | 
 15 |      9 |     12 |    1 |            1 | f             | 
 16 |      4 |      9 |    1 |            1 | f             | 
 17 |     14 |     15 |    1 |            1 | f             | 
 18 |     16 |     17 |    1 |            1 | f             | 
(18 rows)
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Addition of new edges by the algorithm:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">edge_table</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">is_contracted</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">edge_table</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">is_contracted</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">edge_table</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">is_contracted</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">]);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">edge_table</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">reverse_cost</span><span class="p">,</span> <span class="n">is_contracted</span><span class="p">,</span> <span class="n">contracted_vertices</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="nb">ARRAY</span><span class="p">[</span><span class="mi">12</span><span class="p">]);</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Data after addition of new edges:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre>SELECT id, source, target, cost, reverse_cost, is_contracted, contracted_vertices FROM edge_table;
 id | source | target | cost | reverse_cost | is_contracted | contracted_vertices 
----+--------+--------+------+--------------+---------------+---------------------
  1 |      1 |      2 |    1 |            1 | f             | 
  2 |      2 |      3 |   -1 |            1 | f             | 
  3 |      3 |      4 |   -1 |            1 | f             | 
  4 |      2 |      5 |    1 |            1 | f             | 
  5 |      3 |      6 |    1 |           -1 | f             | 
  6 |      7 |      8 |    1 |            1 | f             | 
  7 |      8 |      5 |    1 |            1 | f             | 
  8 |      5 |      6 |    1 |            1 | f             | 
  9 |      6 |      9 |    1 |            1 | f             | 
 10 |      5 |     10 |    1 |            1 | f             | 
 11 |      6 |     11 |    1 |           -1 | f             | 
 12 |     10 |     11 |    1 |           -1 | f             | 
 13 |     11 |     12 |    1 |           -1 | f             | 
 14 |     10 |     13 |    1 |            1 | f             | 
 15 |      9 |     12 |    1 |            1 | f             | 
 16 |      4 |      9 |    1 |            1 | f             | 
 17 |     14 |     15 |    1 |            1 | f             | 
 18 |     16 |     17 |    1 |            1 | f             | 
 -1 |      3 |      5 |    2 |            2 | t             | {1,2}
 -2 |      3 |      9 |    2 |            2 | t             | {4}
 -3 |      5 |     11 |    2 |            2 | t             | {10,13}
 -4 |      9 |     11 |    2 |            2 | t             | {12}
(22 rows)
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Contracted Graph Data:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre>SELECT id, source, target, cost, reverse_cost, is_contracted, contracted_vertices FROM edge_table where source IN (3, 5, 6, 9, 11, 15, 17) AND target IN (3, 5, 6, 9, 11, 15, 17);
 id | source | target | cost | reverse_cost | is_contracted | contracted_vertices 
----+--------+--------+------+--------------+---------------+---------------------
  5 |      3 |      6 |    1 |           -1 | f             | 
  8 |      5 |      6 |    1 |            1 | f             | 
  9 |      6 |      9 |    1 |            1 | f             | 
 11 |      6 |     11 |    1 |           -1 | f             | 
 -1 |      3 |      5 |    2 |            2 | t             | {1,2}
 -2 |      3 |      9 |    2 |            2 | t             | {4}
 -3 |      5 |     11 |    2 |            2 | t             | {10,13}
 -4 |      9 |     11 |    2 |            2 | t             | {12}
(8 rows)
</pre></div>
</div>
</div>
<div class="section" id="dijkstra-on-contracted-graph">
<h3>Dijkstra on contracted graph<a class="headerlink" href="#dijkstra-on-contracted-graph" title="Permalink to this headline">¶</a></h3>
<p>There are five cases which arise when calculating the shortest path between a given source and target,</p>
<p><strong>Case 1</strong>: Both source and target belong to the contracted graph.</p>
<p><strong>Case 2</strong>: Source belongs to a contracted graph, while target belongs to a vertex subgraph.</p>
<p><strong>Case 3</strong>: Source belongs to a contracted graph, while target belongs to an edge subgraph.</p>
<p><strong>Case 4</strong>: Source belongs to a vertex subgraph, while target belongs to an edge subgraph.</p>
<p><strong>Case 5</strong>: The path contains a new edge added by the contraction algorithm.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Examples:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p><strong>Case 1</strong>: Routing from 3 to 11. Since 3 and 11 both are in the contracted graph it is not necessary expand the graph.</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT * FROM pgr_dijkstra(
      &#39;SELECT id, source, target, cost, reverse_cost 
       FROM edge_table 
       WHERE source IN (3, 5, 6, 9, 11, 15, 17) 
       AND target IN (3, 5, 6, 9, 11, 15, 17)&#39;,
       3, 11, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |    5 |    1 |        0
   2 |        2 |    6 |   11 |    1 |        1
   3 |        3 |   11 |   -1 |    0 |        2
(3 rows)
</pre></div>
</div>
<p><strong>Case 2</strong>: Routing from 3 to 7. Since 7 is in the contracted subgraph of vertex 5, it is necessary to expand that vertex by adding {7, 8} to the vertex set, so the vertex set becomes {3, 5, 6, 9, 11, 15, 17 , 7, 8}</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT  *  FROM  pgr_dijkstra(
   &#39;SELECT id, source, target, cost, reverse_cost
    FROM edge_table
    WHERE source IN (3, 5, 6, 9, 11, 15, 17,   7, 8)
    AND target IN (3, 5, 6, 9, 11, 15, 17,   7, 8)&#39;,
    3, 7, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |   -1 |    2 |        0
   2 |        2 |    5 |    7 |    1 |        2
   3 |        3 |    8 |    6 |    1 |        3
   4 |        4 |    7 |   -1 |    0 |        4
(4 rows)
</pre></div>
</div>
<p><strong>Case 3</strong>: Routing from 3 to 13. Since 13 is in the contracted subgraph of edge (5, 11),  it is necessary to expand that edge by adding {10, 13} to the vertex set, so the vertex set becomes {3, 5, 6, 9, 10, 11, 13, 15, 17}.</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT * FROM pgr_dijkstra(
  &#39;SELECT id, source, target, cost, reverse_cost
   FROM edge_table
   WHERE source IN (3, 5, 6, 9, 11, 15, 17,    10, 13)
   AND target IN (3, 5, 6, 9, 11, 15, 17,    10, 13)&#39;,
   3, 13, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |    5 |    1 |        0
   2 |        2 |    6 |   11 |    1 |        1
   3 |        3 |   11 |   12 |    1 |        2
   4 |        4 |   10 |   14 |    1 |        3
   5 |        5 |   13 |   -1 |    0 |        4
(5 rows)
</pre></div>
</div>
<p><strong>Case 4</strong>: Routing from 7 to 13. Since 13 is in the contracted subgraph of edge (5, 11), it is necessary to expand that edge by adding {10, 13} to the vertex set, and since 7 is in the contracted subgraph of vertex 5, it is necessary to expand that vertex by adding {7, 8} vertex set, so the vertex set becomes {3, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17}</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT * FROM pgr_dijkstra(
  &#39;SELECT id, source, target, cost, reverse_cost
   FROM edge_table
   WHERE source IN (3, 5, 6, 9, 11, 15, 17,    7, 8,   10, 13)
   AND target IN (3, 5, 6, 9, 11, 15, 17,    7, 8,   10, 13)&#39;,
   7, 13, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    7 |    6 |    1 |        0
   2 |        2 |    8 |    7 |    1 |        1
   3 |        3 |    5 |   10 |    1 |        2
   4 |        4 |   10 |   14 |    1 |        3
   5 |        5 |   13 |   -1 |    0 |        4
(5 rows)
</pre></div>
</div>
<p><strong>Case 5</strong>: Routing from 3 to 9. Since 3 and 9 both are in the contracted graph it is not necessary expand the graph.</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT * FROM pgr_dijkstra(
    &#39;SELECT id, source, target, cost, reverse_cost 
    FROM edge_table 
    WHERE source IN (3, 5, 6, 9, 11, 15, 17)
    AND target IN (3, 5, 6, 9, 11, 15, 17)&#39;,
    3, 9, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |   -2 |    2 |        0
   2 |        2 |    9 |   -1 |    0 |        2
(2 rows)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>SELECT is_contracted FROM edge_table WHERE id = -2;
 is_contracted 
---------------
 t
(1 row)
</pre></div>
</div>
<p>This implies that it is a shortcut and should be expanded. The contracted subgraph of edge 20(3, 9, c=2) is {4}. It is necessary to expand the edge by adding {4} to the vertex set, so the vertex set becomes {3, 4, 5, 6, 9, 11, 15, 17}.</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT * FROM pgr_dijkstra(
    &#39;SELECT id, source, target, cost, reverse_cost
    FROM edge_table 
    WHERE source IN (3, 5, 6, 9, 11, 15, 17,  4) 
    AND target IN (3, 5, 6, 9, 11, 15, 17,  4) 
    AND is_contracted = false&#39;,
    3, 9, false);
 seq | path_seq | node | edge | cost | agg_cost 
-----+----------+------+------+------+----------
   1 |        1 |    3 |    3 |    1 |        0
   2 |        2 |    4 |   16 |    1 |        1
   3 |        3 |    9 |   -1 |    0 |        2
(3 rows)
</pre></div>
</div>
</div>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf">http://www.cs.cmu.edu/afs/cs/academic/class/15210-f12/www/lectures/lecture16.pdf</a></li>
<li><a class="reference external" href="http://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf">http://algo2.iti.kit.edu/documents/routeplanning/geisberger_dipl.pdf</a></li>
</ul>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="../../proposed.html">Experimental and Proposed functions</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../../doc/index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="pgr_contractGraph.html">pgr_contractGraph - Proposed</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright pgRouting Contributors - Version 2.3.0 (pgrouting-2.3.0-dev).
      Last updated on Aug 06, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>